<!DOCTYPE html>
<html lang="de" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complyo - Von abmahngefährdet zu rechtssicher in 24h</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'complyo-primary': '#6366f1',
                        'complyo-secondary': '#8b5cf6',
                        'complyo-accent': '#06b6d4',
                        'complyo-dark': '#0f172a',
                        'complyo-gray': '#1e293b'
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        * { font-family: 'Inter', sans-serif; }
        
        .danger-alert {
            background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
            animation: danger-pulse 2s infinite;
        }
        
        @keyframes danger-pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.3); }
            50% { transform: scale(1.02); box-shadow: 0 0 0 20px rgba(239, 68, 68, 0); }
        }
        
        .floating-circles {
            position: absolute;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(59, 130, 246, 0.1) 100%);
            filter: blur(40px);
        }
        
        .circle-1 { top: 10%; right: 10%; animation: float 6s ease-in-out infinite; }
        .circle-2 { top: 60%; left: 5%; animation: float 8s ease-in-out infinite reverse; }
        .circle-3 { bottom: 10%; right: 20%; animation: float 7s ease-in-out infinite; }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="bg-complyo-dark text-white overflow-x-hidden">
    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 bg-complyo-dark/80 backdrop-blur-md border-b border-complyo-gray/20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <div class="text-2xl font-bold bg-gradient-to-r from-complyo-primary to-complyo-accent bg-clip-text text-transparent">
                        Complyo
                    </div>
                    <span class="ml-2 text-xs bg-complyo-primary/20 text-complyo-primary px-2 py-1 rounded-full font-medium">BETA</span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-8">
                        <a href="#features" class="text-gray-300 hover:text-white transition-colors">Features</a>
                        <a href="#pricing" class="text-gray-300 hover:text-white transition-colors">Preise</a>
                        <a href="#how-it-works" class="text-gray-300 hover:text-white transition-colors">So funktioniert's</a>
                        <a href="#scanner" class="text-gray-300 hover:text-white transition-colors">Scanner</a>
                        <button id="navCtaBtn" class="bg-complyo-primary hover:bg-complyo-primary/80 px-4 py-2 rounded-lg transition-colors">
                            Kostenlos testen
                        </button>
                    </div>
                </div>
                <div class="md:hidden">
                    <button id="mobileMenuBtn" class="text-gray-300 hover:text-white">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobileMenu" class="md:hidden hidden bg-complyo-dark/95 backdrop-blur-md border-t border-complyo-gray/20">
            <div class="px-4 py-6 space-y-4">
                <a href="#features" class="block text-gray-300 hover:text-white transition-colors">Features</a>
                <a href="#pricing" class="block text-gray-300 hover:text-white transition-colors">Preise</a>
                <a href="#how-it-works" class="block text-gray-300 hover:text-white transition-colors">So funktioniert's</a>
                <a href="#scanner" class="block text-gray-300 hover:text-white transition-colors">Scanner</a>
                <button class="w-full bg-complyo-primary hover:bg-complyo-primary/80 px-4 py-2 rounded-lg transition-colors">
                    Kostenlos testen
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="pt-24 pb-20 relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-br from-complyo-primary/20 via-complyo-secondary/20 to-complyo-accent/20"></div>
        <div class="floating-circles circle-1"></div>
        <div class="floating-circles circle-2"></div>
        <div class="floating-circles circle-3"></div>
        
        <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid lg:grid-cols-2 gap-12 items-center">
                <!-- Left: Text Content -->
                <div class="space-y-8">
                    <div class="space-y-4">
                        <div class="inline-flex items-center glass-effect rounded-full px-6 py-3 mb-4">
                            <i class="fas fa-shield-alt text-complyo-accent mr-2"></i>
                            <span class="text-white font-medium">Deutschlands erste All-in-One Compliance-Lösung</span>
                        </div>
                        
                        <h1 class="text-5xl lg:text-6xl font-bold leading-tight">
                            Von <span class="text-red-400">abmahngefährdet</span><br>
                            zu <span class="bg-gradient-to-r from-complyo-primary to-complyo-accent bg-clip-text text-transparent">rechtssicher</span><br>
                            in <span class="text-yellow-300">24 Stunden</span>
                        </h1>
                        <p class="text-xl text-gray-300 max-w-xl">
                            Die erste All-in-One Compliance-Plattform mit echtem Abmahnschutz. 
                            KI-gestützt oder durch Experten - automatisch DSGVO-konform.
                        </p>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row gap-4">
                        <button id="startAnalysisBtn" class="bg-gradient-to-r from-complyo-primary to-complyo-secondary hover:from-complyo-primary/80 hover:to-complyo-secondary/80 px-8 py-4 rounded-lg text-lg font-semibold transition-all transform hover:scale-105">
                            <i class="fas fa-shield-alt mr-2"></i>
                            Kostenlose Analyse starten
                        </button>
                        <button class="border border-complyo-primary text-complyo-primary hover:bg-complyo-primary hover:text-white px-8 py-4 rounded-lg text-lg font-semibold transition-all">
                            <i class="fas fa-play mr-2"></i>
                            Demo ansehen
                        </button>
                    </div>

                    <!-- Risk Calculator Teaser -->
                    <div class="bg-red-500/10 border border-red-500/20 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-red-400 mb-2">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            Ihr aktuelles Abmahn-Risiko
                        </h3>
                        <div class="text-2xl font-bold text-red-400">4.000€ - 20.000€+</div>
                        <p class="text-sm text-gray-300 mt-2">pro Website ohne Compliance-Schutz</p>
                    </div>
                </div>

                <!-- Right: Website Test Tool -->
                <div class="bg-complyo-gray/50 backdrop-blur-sm rounded-2xl p-8 border border-complyo-primary/20">
                    <h3 class="text-2xl font-bold mb-6 text-center">
                        <i class="fas fa-search mr-2 text-complyo-accent"></i>
                        Sofort-Analyse Ihrer Website
                    </h3>
                    
                    <form id="websiteAnalysisForm" class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium mb-2">Website-URL</label>
                            <input 
                                type="url" 
                                id="websiteUrl" 
                                placeholder="https://ihre-website.de" 
                                class="w-full px-4 py-3 bg-complyo-dark border border-complyo-primary/30 rounded-lg focus:border-complyo-primary focus:ring-2 focus:ring-complyo-primary/20 outline-none transition-all"
                                required
                            >
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">E-Mail für Ergebnis</label>
                            <input 
                                type="email" 
                                id="userEmail" 
                                placeholder="ihre@email.de" 
                                class="w-full px-4 py-3 bg-complyo-dark border border-complyo-primary/30 rounded-lg focus:border-complyo-primary focus:ring-2 focus:ring-complyo-primary/20 outline-none transition-all"
                                required
                            >
                        </div>

                        <button 
                            type="submit" 
                            class="w-full bg-gradient-to-r from-complyo-accent to-complyo-secondary hover:from-complyo-accent/80 hover:to-complyo-secondary/80 px-6 py-4 rounded-lg font-semibold text-lg transition-all transform hover:scale-105"
                        >
                            <i class="fas fa-rocket mr-2"></i>
                            Kostenlose Analyse starten
                        </button>
                    </form>

                    <div id="analysisResults" class="hidden mt-6 space-y-4"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- KRITISCHE WARNUNG Section -->
    <section class="py-12 relative -mt-8 z-20">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="danger-alert rounded-2xl p-8 text-white relative overflow-hidden">
                <div class="absolute -top-4 left-1/2 transform -translate-x-1/2">
                    <div class="bg-red-600 text-white px-6 py-2 rounded-full font-black text-lg animate-pulse">
                        🚨 SOFORTIGE GEFAHR! 🚨
                    </div>
                </div>
                
                <div class="pt-6 text-center">
                    <h2 class="text-3xl md:text-4xl font-black mb-4">
                        IHRE WEBSITE IST ABMAHNGEFÄHRDET!
                    </h2>
                    <p class="text-xl md:text-2xl mb-6 text-red-100">
                        Jede Minute ohne Compliance kostet Sie potentiell<br>
                        <span class="text-3xl font-black text-yellow-300">4.000-20.000€</span> in Abmahnungen
                    </p>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-white/10 rounded-lg p-4">
                            <div class="text-2xl font-bold">500-3.000€</div>
                            <div class="text-sm">Fehlende Rechtstexte</div>
                        </div>
                        <div class="bg-white/10 rounded-lg p-4">
                            <div class="text-2xl font-bold">1.000-5.000€</div>
                            <div class="text-sm">Cookie-Verstöße</div>
                        </div>
                        <div class="bg-white/10 rounded-lg p-4">
                            <div class="text-2xl font-bold">2.000-10.000€</div>
                            <div class="text-sm">DSGVO-Verletzungen</div>
                        </div>
                        <div class="bg-white/10 rounded-lg p-4">
                            <div class="text-2xl font-bold">500-2.000€</div>
                            <div class="text-sm">Barrierefreiheit</div>
                        </div>
                    </div>
                    
                    <button id="emergencyCheckBtn" class="bg-yellow-400 text-red-800 px-8 py-4 rounded-lg font-black text-xl hover:bg-yellow-300 transition-all transform hover:scale-105">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        NOTFALL-CHECK JETZT STARTEN!
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Trust Indicators -->
    <section class="py-12 bg-complyo-gray/30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-8 text-center">
                <div class="space-y-2">
                    <div class="text-3xl font-bold text-complyo-primary">99%</div>
                    <div class="text-sm text-gray-300">Weniger Abmahn-Risiko</div>
                </div>
                <div class="space-y-2">
                    <div class="text-3xl font-bold text-complyo-accent">24h</div>
                    <div class="text-sm text-gray-300">Bis zur Rechtssicherheit</div>
                </div>
                <div class="space-y-2">
                    <div class="text-3xl font-bold text-complyo-secondary">500+</div>
                    <div class="text-sm text-gray-300">Geschützte Websites</div>
                </div>
                <div class="space-y-2">
                    <div class="text-3xl font-bold text-green-400">4.9/5</div>
                    <div class="text-sm text-gray-300">Kundenbewertung</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section - Die 4 Säulen -->
    <section id="features" class="py-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-4xl font-bold mb-4">Die 4 Säulen der Compliance</h2>
                <p class="text-xl text-gray-300 max-w-3xl mx-auto">
                    Vollständiger Schutz durch KI-gestützte Automatisierung oder Experten-Service
                </p>
            </div>

            <div class="grid lg:grid-cols-2 gap-8">
                <!-- Säule 1: Rechtliche Texte -->
                <div class="bg-complyo-gray/50 rounded-2xl p-8 border border-complyo-primary/20 hover:border-complyo-primary/40 transition-all">
                    <div class="flex items-center mb-6">
                        <div class="bg-complyo-primary/20 p-3 rounded-lg mr-4">
                            <i class="fas fa-file-contract text-2xl text-complyo-primary"></i>
                        </div>
                        <h3 class="text-2xl font-bold">Rechtliche Texte</h3>
                    </div>
                    <ul class="space-y-3 text-gray-300 mb-6">
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Vollständiges Impressum (DSGVO-konform)</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Datenschutzerklärung (inkl. Social Media)</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>AGB & Widerrufsbelehrung</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Automatische Updates bei Rechtsänderungen</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Multi-Language Support (DE/EN)</li>
                    </ul>
                    <div class="bg-complyo-primary/10 rounded-lg p-3">
                        <div class="text-sm text-complyo-primary font-medium">
                            <i class="fas fa-shield-alt mr-1"></i>
                            eRecht24 Premium Integration
                        </div>
                    </div>
                </div>

                <!-- Säule 2: Cookie-Compliance -->
                <div class="bg-complyo-gray/50 rounded-2xl p-8 border border-complyo-accent/20 hover:border-complyo-accent/40 transition-all">
                    <div class="flex items-center mb-6">
                        <div class="bg-complyo-accent/20 p-3 rounded-lg mr-4">
                            <i class="fas fa-cookie-bite text-2xl text-complyo-accent"></i>
                        </div>
                        <h3 class="text-2xl font-bold">Cookie-Compliance</h3>
                    </div>
                    <ul class="space-y-3 text-gray-300 mb-6">
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Cookie-Banner-Implementierung</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Consent Management Platform</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Third-Party-Script-Erfassung</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Cookie-Kategorisierung & -Dokumentation</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>TTDSG/DSGVO-konforme Mechanismen</li>
                    </ul>
                    <div class="bg-complyo-accent/10 rounded-lg p-3">
                        <div class="text-sm text-complyo-accent font-medium">
                            <i class="fas fa-shield-alt mr-1"></i>
                            TTDSG §25 + DSGVO Art. 7 konform
                        </div>
                    </div>
                </div>

                <!-- Säule 3: DSGVO-Compliance -->
                <div class="bg-complyo-gray/50 rounded-2xl p-8 border border-complyo-secondary/20 hover:border-complyo-secondary/40 transition-all">
                    <div class="flex items-center mb-6">
                        <div class="bg-complyo-secondary/20 p-3 rounded-lg mr-4">
                            <i class="fas fa-shield-alt text-2xl text-complyo-secondary"></i>
                        </div>
                        <h3 class="text-2xl font-bold">DSGVO-Compliance</h3>
                    </div>
                    <ul class="space-y-3 text-gray-300 mb-6">
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Datenverarbeitungs-Audit</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Privacy-by-Design-Implementierung</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Betroffenenrechte-Management</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Verzeichnis der Verarbeitungstätigkeiten</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Datenschutz-Folgenabschätzung (DSFA)</li>
                    </ul>
                    <div class="bg-complyo-secondary/10 rounded-lg p-3">
                        <div class="text-sm text-complyo-secondary font-medium">
                            <i class="fas fa-shield-alt mr-1"></i>
                            EU-DSGVO Art. 13/14 + deutsche Aufsichtsbehörden
                        </div>
                    </div>
                </div>

                <!-- Säule 4: Barrierefreiheit -->
                <div class="bg-complyo-gray/50 rounded-2xl p-8 border border-green-500/20 hover:border-green-500/40 transition-all">
                    <div class="flex items-center mb-6">
                        <div class="bg-green-500/20 p-3 rounded-lg mr-4">
                            <i class="fas fa-universal-access text-2xl text-green-400"></i>
                        </div>
                        <h3 class="text-2xl font-bold">Barrierefreiheit</h3>
                    </div>
                    <ul class="space-y-3 text-gray-300 mb-6">
                        <li><i class="fas fa-check text-green-400 mr-2"></i>WCAG 2.1 AA + BITV 2.0 Audit</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Screen-Reader-Optimierung</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Keyboard-Navigation-Fixes</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Farbkontrast-Optimierung</li>
                        <li><i class="fas fa-check text-green-400 mr-2"></i>Alternative Medien-Bereitstellung</li>
                    </ul>
                    <div class="bg-green-500/10 rounded-lg p-3">
                        <div class="text-sm text-green-400 font-medium">
                            <i class="fas fa-shield-alt mr-1"></i>
                            WCAG 2.1 AA + BITV 2.0 + BGG Standards
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Detailed Scanner Section -->
    <section id="scanner" class="py-20 bg-complyo-gray/30">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold mb-4">Vollständige Compliance-Analyse</h2>
                <p class="text-xl text-gray-300">
                    Erhalten Sie einen detaillierten Report über alle kritischen Compliance-Risiken
                </p>
            </div>
            
            <div class="bg-complyo-gray/50 rounded-2xl shadow-2xl p-8 border border-complyo-primary/20">
                <div class="flex flex-col md:flex-row gap-4 mb-6">
                    <div class="flex-1">
                        <label class="block text-sm font-medium mb-2">Website-URL für detaillierte Analyse</label>
                        <input 
                            type="url" 
                            id="detailedScanUrl"
                            placeholder="https://ihre-website.de" 
                            class="w-full px-4 py-4 bg-complyo-dark border border-complyo-primary/30 rounded-lg focus:border-complyo-primary focus:ring-2 focus:ring-complyo-primary/20 outline-none transition-all text-lg"
                        >
                    </div>
                    <div class="flex items-end">
                        <button 
                            onclick="startDetailedScan()"
                            class="bg-gradient-to-r from-complyo-primary to-complyo-secondary hover:from-complyo-primary/80 hover:to-complyo-secondary/80 px-8 py-4 rounded-lg font-semibold text-lg transition-all transform hover:scale-105 whitespace-nowrap"
                        >
                            <i class="fas fa-search mr-2"></i>
                            Detailliert scannen
                        </button>
                    </div>
                </div>
                
                <div id="detailedScanResults" class="hidden">
                    <div class="bg-complyo-dark/50 rounded-xl p-6 mb-6 border border-complyo-primary/20">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-2xl font-bold">Scan-Ergebnisse</h3>
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-complyo-accent rounded-full animate-pulse mr-2"></div>
                                <span class="text-sm text-gray-300">Live-Analyse abgeschlossen</span>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                            <div class="text-center">
                                <div id="detailedComplianceScore" class="text-4xl font-bold text-red-400 mb-2">--</div>
                                <div class="text-sm text-gray-300">Compliance-Score</div>
                                <div class="w-full bg-complyo-dark rounded-full h-2 mt-2">
                                    <div id="detailedScoreBar" class="bg-gradient-to-r from-red-500 to-yellow-500 h-2 rounded-full" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="text-center">
                                <div id="detailedRiskAmount" class="text-2xl font-bold text-red-400 mb-2">--</div>
                                <div class="text-sm text-gray-300">Abmahn-Risiko (€)</div>
                            </div>
                            <div class="text-center">
                                <div id="detailedCriticalIssues" class="text-2xl font-bold text-red-400 mb-2">--</div>
                                <div class="text-sm text-gray-300">Kritische Verstöße</div>
                            </div>
                            <div class="text-center">
                                <div id="detailedTotalIssues" class="text-2xl font-bold text-yellow-400 mb-2">--</div>
                                <div class="text-sm text-gray-300">Gesamt-Issues</div>
                            </div>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-6 mb-8">
                            <div>
                                <h4 class="font-semibold mb-4 text-lg">
                                    <i class="fas fa-exclamation-triangle text-red-400 mr-2"></i>
                                    Kritische Compliance-Verstöße
                                </h4>
                                <div id="criticalIssuesList" class="space-y-3">
                                    <!-- Critical issues will be populated here -->
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="font-semibold mb-4 text-lg">
                                    <i class="fas fa-info-circle text-yellow-400 mr-2"></i>
                                    Weitere Optimierungen
                                </h4>
                                <div id="otherIssuesList" class="space-y-3">
                                    <!-- Other issues will be populated here -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Email Report Section -->
                        <div class="bg-complyo-primary/10 rounded-lg p-6 mb-8">
                            <h4 class="font-semibold mb-4 text-complyo-primary
                            <!-- Email Report Section -->
                            <div class="bg-complyo-primary/10 rounded-lg p-6 mb-8">
                                <h4 class="font-semibold mb-4 text-complyo-primary">
                                    <i class="fas fa-envelope mr-2"></i>
                                    Detaillierten PDF-Report erhalten
                                </h4>
                                <div class="flex flex-col sm:flex-row gap-4">
                                    <input 
                                        type="email" 
                                        id="reportEmail"
                                        placeholder="ihre@email.de für PDF-Report" 
                                        class="flex-1 px-4 py-3 bg-complyo-dark border border-complyo-primary/30 rounded-lg focus:border-complyo-primary focus:ring-2 focus:ring-complyo-primary/20 outline-none transition-all"
                                    >
                                    <button 
                                        onclick="sendDetailedReport()"
                                        class="bg-complyo-primary hover:bg-complyo-primary/80 px-6 py-3 rounded-lg font-semibold transition-all whitespace-nowrap"
                                    >
                                        <i class="fas fa-file-pdf mr-2"></i>
                                        PDF-Report senden
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="grid md:grid-cols-2 gap-4">
                                <button 
                                    onclick="selectPlan('ai')"
                                    class="bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white px-8 py-4 rounded-lg font-semibold text-lg transition-all transform hover:scale-105"
                                >
                                    <i class="fas fa-robot mr-2"></i>
                                    KI-Automatisierung (39€/Monat)
                                    <div class="text-sm opacity-80 mt-1">24h-Umsetzungsgarantie</div>
                                </button>
                                <button 
                                    onclick="selectPlan('expert')"
                                    class="bg-gradient-to-r from-complyo-secondary to-complyo-accent hover:from-complyo-secondary/80 hover:to-complyo-accent/80 text-white px-8 py-4 rounded-lg font-semibold text-lg transition-all transform hover:scale-105"
                                >
                                    <i class="fas fa-user-tie mr-2"></i>
                                    Experten-Service (2.000€ + 39€)
                                    <div class="text-sm opacity-80 mt-1">Persönliche Betreuung</div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    
        <!-- Pricing Section -->
        <section id="pricing" class="py-20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-16">
                    <h2 class="text-4xl font-bold mb-4">Wählen Sie Ihren Schutz</h2>
                    <p class="text-xl text-gray-300">
                        KI-Automatisierung oder Experten-Service - Sie entscheiden
                    </p>
                </div>
    
                <div class="grid lg:grid-cols-3 gap-8">
                    <!-- Kostenlose Analyse -->
                    <div class="bg-complyo-gray/50 rounded-2xl p-8 border border-complyo-primary/20">
                        <div class="text-center mb-8">
                            <h3 class="text-2xl font-bold mb-2">Kostenlose Analyse</h3>
                            <div class="text-4xl font-bold text-complyo-accent mb-2">0€</div>
                            <p class="text-gray-300">Einmalig kostenlos</p>
                        </div>
                        
                        <ul class="space-y-3 mb-8">
                            <li class="flex items-center"><i class="fas fa-check text-green-400 mr-3"></i>Vollständiger Compliance-Scan</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-400 mr-3"></i>Abmahn-Risiko-Bewertung mit €-Beträgen</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-400 mr-3"></i>Prioritäten-Liste nach Dringlichkeit</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-400 mr-3"></i>PDF-Report mit Handlungsempfehlungen</li>
                            <li class="flex items-center"><i class="fas fa-check text-green-400 mr-3"></i>Keine Verpflichtungen</li>
                        </ul>
                        
                        <button 
                            onclick="startFreeAnalysis()"
                            class="w-full bg-complyo-accent hover:bg-complyo-accent/80 text-white py-3 rounded-lg font-semibold transition-all"
                        >
                            Jetzt kostenlos starten
                        </button>
                        
                        <div class="text-center mt-4">
                            <div class="text-sm text-gray-400">✓ Keine Registrierung erforderlich</div>
                        </div>
                    </div>
    
                    <!-- KI-Automatisierung -->
                    <div class="bg-gradient-to-br from-complyo-primary/20 to-complyo-secondary/20 rounded-2xl p-8 border-2 border-complyo-primary relative transform hover:scale-105 transition-all">
                        <div class="absolute -top-4 left-1/2 transform -translate-x-1/2 bg-complyo-primary px-4 py-2 rounded-full text-sm font-semibold">
                            BELIEBT
                        </div>
                        
                        <div class="text-center mb-8">
                            <h3 class="text-2xl font-bold mb-2">KI-Automatisierung</h3>
                            <p class="text-gray-300 mb-4">Der intelligente Weg zur Compliance</p>
                            <div class="text-4xl font-bold text-complyo-primary mb-2">39€</div>
                            <p class="text-gray-300">pro Monat</p>
                            <div class="inline-block bg-green-500/20 text-green-400 px-3 py-1 rounded-full text-sm font-medium mt-2">
                                24h-Umsetzungsgarantie
                            </div>
                        </div>
                        
                        <ul class="space-y-3 mb-8">
                            <li class="flex items-center"><i class="fas fa-robot text-complyo-primary mr-3"></i>KI-gestützte Website-Überarbeitung (GPT-4 + Claude)</li>
                            <li class="flex items-center"><i class="fas fa-file-alt text-complyo-primary mr-3"></i>Automatische Rechtstext-Integration (eRecht24)</li>
                            <li class="flex items-center"><i class="fas fa-cookie-bite text-complyo-primary mr-3"></i>Cookie-Banner-Implementation (Usercentrics)</li>
                            <li class="flex items-center"><i class="fas fa-sync text-complyo-primary mr-3"></i>Monatliche Re-Scans mit automatischen Fixes</li>
                            <li class="flex items-center"><i class="fas fa-dashboard text-complyo-primary mr-3"></i>Live-Monitoring Dashboard</li>
                            <li class="flex items-center"><i class="fas fa-clock text-complyo-primary mr-3"></i>24h-Umsetzung für Standard-Websites</li>
                        </ul>
                        
                        <button 
                            onclick="selectPlan('ai')" 
                            class="w-full bg-complyo-primary hover:bg-complyo-primary/80 px-6 py-4 rounded-lg font-semibold text-lg transition-all transform hover:scale-105"
                        >
                            KI-Plan wählen
                        </button>
                        
                        <div class="text-center mt-4">
                            <div class="text-sm text-gray-400">
                                <i class="fas fa-users mr-1"></i>
                                Ideal für kleine bis mittlere Websites
                            </div>
                        </div>
                    </div>
    
                    <!-- Expert Plan -->
                    <div class="bg-gradient-to-br from-complyo-secondary/20 to-complyo-accent/20 rounded-2xl p-8 border border-complyo-secondary relative">
                        <div class="text-center mb-8">
                            <h3 class="text-2xl font-bold mb-2">Experten-Service</h3>
                            <p class="text-gray-300 mb-4">Profi-Lösung für komplexe Fälle</p>
                            <div class="space-y-2">
                                <div class="text-2xl font-bold text-complyo-secondary">2.000€ Setup</div>
                                <div class="text-xl text-complyo-accent">+ 39€/Monat</div>
                            </div>
                        </div>
                        
                        <ul class="space-y-3 mb-8">
                            <li class="flex items-center"><i class="fas fa-user-tie text-complyo-secondary mr-3"></i>Persönliche Experten-Betreuung (Anwalt + Tech)</li>
                            <li class="flex items-center"><i class="fas fa-search-plus text-complyo-secondary mr-3"></i>Deep-Dive-Audit aller Geschäftsprozesse</li>
                            <li class="flex items-center"><i class="fas fa-industry text-complyo-secondary mr-3"></i>Branchenspezifische Compliance (Healthcare, Finance)</li>
                            <li class="flex items-center"><i class="fas fa-cogs text-complyo-secondary mr-3"></i>Custom-Integration in komplexe IT-Landschaften</li>
                            <li class="flex items-center"><i class="fas fa-phone text-complyo-secondary mr-3"></i>Direkte Experten-Hotline bei Rechtsfragen</li>
                            <li class="flex items-center"><i class="fas fa-calendar text-complyo-secondary mr-3"></i>Quartalsweise Review-Calls mit Compliance-Officer</li>
                        </ul>
                        
                        <button 
                            onclick="selectPlan('expert')" 
                            class="w-full bg-gradient-to-r from-complyo-secondary to-complyo-accent hover:from-complyo-secondary/80 hover:to-complyo-accent/80 px-6 py-4 rounded-lg font-semibold text-lg transition-all"
                        >
                            Experten-Plan wählen
                        </button>
                        
                        <div class="text-center mt-4">
                            <div class="text-sm text-gray-400">
                                <i class="fas fa-building mr-1"></i>
                                Ideal für Enterprise & hochregulierte Branchen
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Pricing Comparison -->
                <div class="mt-16 bg-complyo-gray/50 rounded-2xl p-8 border border-complyo-primary/20">
                    <h3 class="text-2xl font-bold text-center mb-8">Detaillierter Vergleich</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="border-b border-complyo-primary/20">
                                    <th class="text-left py-3 px-4">Feature</th>
                                    <th class="text-center py-3 px-4">Kostenlos</th>
                                    <th class="text-center py-3 px-4 bg-complyo-primary/10">KI-Automatisierung</th>
                                    <th class="text-center py-3 px-4">Experten-Service</th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-300">
                                <tr class="border-b border-complyo-gray/30">
                                    <td class="py-3 px-4">Website-Compliance-Scan</td>
                                    <td class="text-center py-3 px-4"><i class="fas fa-check text-green-400"></i></td>
                                    <td class="text-center py-3 px-4 bg-complyo-primary/5"><i class="fas fa-check text-green-400"></i></td>
                                    <td class="text-center py-3 px-4"><i class="fas fa-check text-green-400"></i></td>
                                </tr>
                                <tr class="border-b border-complyo-gray/30">
                                    <td class="py-3 px-4">PDF-Report mit Handlungsempfehlungen</td>
                                    <td class="text-center py-3 px-4"><i class="fas fa-check text-green-400"></i></td>
                                    <td class="text-center py-3 px-4 bg-complyo-primary/5"><i class="fas fa-check text-green-400"></i></td>
                                    <td class="text-center py-3 px-4"><i class="fas fa-check text-green-400"></i></td>
                                </tr>
                                <tr class="border-b border-complyo-gray/30">
                                    <td class="py-3 px-4">Automatische Rechtstext-Generierung</td>
                                    <td class="text-center py-3 px-4"><i class="fas fa-times text-red-400"></i></td>
                                    <td class="text-center py-3 px-4 bg-complyo-primary/5"><i class="fas fa-check text-green-400"></i></td>
                                    <td class="text-center py-3 px-4"><i class="fas fa-check text-green-400"></i></td>
                                </tr>
                                <tr class="border-b border-complyo-gray/30">
                                    <td class="py-3 px-4">Cookie-Banner-Implementation</td>
                                    <td class="text-center py-3 px-4"><i class="fas fa-times text-red-400"></i></td>
                                    <td class="text-center py-3 px-4 bg-complyo-primary/5"><i class="fas fa-check text-green-400"></i></td>
                                    <td class="text-center py-3 px-4"><i class="fas fa-check text-green-400"></i></td>
                                </tr>
                                <tr class="border-b border-complyo-gray/30">
                                    <td class="py-3 px-4">Live-Monitoring & Alerts</td>
                                    <td class="text-center py-3 px-4"><i class="fas fa-times text-red-400"></i></td>
                                    <td class="text-center py-3 px-4 bg-complyo-primary/5"><i class="fas fa-check text-green-400"></i></td>
                                    <td class="text-center py-3 px-4"><i class="fas fa-check text-green-400"></i></td>
                                </tr>
                                <tr class="border-b border-complyo-gray/30">
                                    <td class="py-3 px-4">Persönliche Experten-Betreuung</td>
                                    <td class="text-center py-3 px-4"><i class="fas fa-times text-red-400"></i></td>
                                    <td class="text-center py-3 px-4 bg-complyo-primary/5"><i class="fas fa-times text-red-400"></i></td>
                                    <td class="text-center py-3 px-4"><i class="fas fa-check text-green-400"></i></td>
                                </tr>
                                <tr class="border-b border-complyo-gray/30">
                                    <td class="py-3 px-4">Branchenspezifische Compliance</td>
                                    <td class="text-center py-3 px-4"><i class="fas fa-times text-red-400"></i></td>
                                    <td class="text-center py-3 px-4 bg-complyo-primary/5"><i class="fas fa-times text-red-400"></i></td>
                                    <td class="text-center py-3 px-4"><i class="fas fa-check text-green-400"></i></td>
                                </tr>
                                <tr>
                                    <td class="py-3 px-4">Direkte Experten-Hotline</td>
                                    <td class="text-center py-3 px-4"><i class="fas fa-times text-red-400"></i></td>
                                    <td class="text-center py-3 px-4 bg-complyo-primary/5"><i class="fas fa-times text-red-400"></i></td>
                                    <td class="text-center py-3 px-4"><i class="fas fa-check text-green-400"></i></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
    
        <!-- How it Works -->
        <section id="how-it-works" class="py-20 bg-complyo-gray/30">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-16">
                    <h2 class="text-4xl font-bold mb-4">So funktioniert's</h2>
                    <p class="text-xl text-gray-300">Von der Analyse zur rechtssicheren Website in 3 einfachen Schritten</p>
                </div>
    
                <div class="grid lg:grid-cols-3 gap-8">
                    <div class="text-center">
                        <div class="bg-complyo-primary/20 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
                            <span class="text-3xl font-bold text-complyo-primary">1</span>
                        </div>
                        <h3 class="text-2xl font-bold mb-4">Kostenlose Analyse</h3>
                        <p class="text-gray-300 mb-6">
                            Vollständiger Compliance-Scan Ihrer Website mit detaillierter Abmahn-Risiko-Bewertung in Euro und PDF-Report
                        </p>
                        <div class="bg-complyo-primary/10 rounded-lg p-4">
                            <div class="text-sm text-complyo-primary font-medium">
                                <i class="fas fa-clock mr-1"></i>Dauert nur 2-3 Minuten
                            </div>
                        </div>
                    </div>
    
                    <div class="text-center">
                        <div class="bg-complyo-accent/20 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
                            <span class="text-3xl font-bold text-complyo-accent">2</span>
                        </div>
                        <h3 class="text-2xl font-bold mb-4">Plan auswählen</h3>
                        <p class="text-gray-300 mb-6">
                            KI-Automatisierung für schnelle Umsetzung in 24h oder Experten-Service für komplexe Anforderungen mit persönlicher Betreuung
                        </p>
                        <div class="bg-complyo-accent/10 rounded-lg p-4">
                            <div class="text-sm text-complyo-accent font-medium">
                                <i class="fas fa-shield-alt mr-1"></i>Beide mit Abmahnschutz
                            </div>
                        </div>
                    </div>
    
                    <div class="text-center">
                        <div class="bg-complyo-secondary/20 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
                            <span class="text-3xl font-bold text-complyo-secondary">3</span>
                        </div>
                        <h3 class="text-2xl font-bold mb-4">Rechtssicherheit</h3>
                        <p class="text-gray-300 mb-6">
                            Automatische Umsetzung durch KI in 24h oder professionelles Experten-Setup mit kontinuierlicher Überwachung und Updates
                        </p>
                        <div class="bg-complyo-secondary/10 rounded-lg p-4">
                            <div class="text-sm text-complyo-secondary font-medium">
                                <i class="fas fa-check-circle mr-1"></i>99% weniger Abmahn-Risiko
                            </div>
                        </div>
                    </div>
                </div>
    
                <!-- Process Details -->
                <div class="mt-16 bg-complyo-gray/50 rounded-2xl p-8 border border-complyo-primary/20">
                    <h3 class="text-2xl font-bold mb-8 text-center">Was passiert nach Ihrer Buchung?</h3>
                    
                    <div class="grid md:grid-cols-2 gap-8">
                        <!-- KI-Prozess -->
                        <div class="space-y-4">
                            <h4 class="text-xl font-bold text-complyo-primary mb-4">
                                <i class="fas fa-robot mr-2"></i>KI-Automatisierung Prozess
                            </h4>
                            <div class="space-y-3">
                                <div class="flex items-start space-x-3">
                                    <div class="bg-complyo-primary w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold text-white mt-1">1</div>
                                    <div>
                                        <div class="font-medium">Automatische Website-Analyse</div>
                                        <div class="text-sm text-gray-400">Vollständiger Scan aller Compliance-Bereiche</div>
                                    </div>
                                </div>
                                <div class="flex items-start space-x-3">
                                    <div class="bg-complyo-primary w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold text-white mt-1">2</div>
                                    <div>
                                        <div class="font-medium">KI-Content-Generierung</div>
                                        <div class="text-sm text-gray-400">GPT-4 erstellt Impressum, Datenschutz, Cookie-Banner</div>
                                    </div>
                                </div>
                                <div class="flex items-start space-x-3">
                                    <div class="bg-complyo-primary w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold text-white mt-1">3</div>
                                    <div>
                                        <div class="font-medium">Automatische Implementation</div>
                                        <div class="text-sm text-gray-400">Code-Integration und Funktionalitäts-Tests</div>
                                    </div>
                                </div>
                                <div class="flex items-start space-x-3">
                                    <div class="bg-complyo-primary w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold text-white mt-1">4</div>
                                    <div>
                                        <div class="font-medium">Validierung & Go-Live</div>
                                        <div class="text-sm text-gray-400">Finale Compliance-Prüfung und Aktivierung</div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-green-500/10 rounded-lg p-3 mt-4">
                                <div class="text-sm text-green-400 font-medium">
                                    <i class="fas fa-clock mr-2"></i>Fertig in 2-24 Stunden
                                </div>
                            </div>
                        </div>
                        
                        <!-- Experten-Prozess -->
                        <div class="space-y-4">
                            <h4 class="text-xl font-bold text-complyo-secondary mb-4">
                                <i class="fas fa-user-tie mr-2"></i>Experten-Service Prozess
                            </h4>
                            <div class="space-y-3">
                                <div class="flex items-start space-x-3">
                                    <div class="bg-complyo-secondary w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold text-white mt-1">1</div>
                                    <div>
                                        <div class="font-medium">Persönliches Beratungsgespräch</div>
                                        <div class="text-sm text-gray-400">60min Deep-Dive mit Compliance-Experten</div>
                                    </div>
                                </div>
                                <div class="flex items-start space-x-3">
                                    <div class="bg-complyo-secondary w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold text-white mt-1">2</div>
                                    <div>
                                        <div class="font-medium">Branchen-spezifische Analyse</div>
                                        <div class="text-sm text-gray-400">Individuelle Compliance-Strategie-Entwicklung</div>
                                    </div>
                                </div>
                                <div class="flex items-start space-x-3">
                                    <div class="bg-complyo-secondary w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold text-white mt-1">3</div>
                                    <div>
                                        <div class="font-medium">Professionelle Umsetzung</div>
                                        <div class="text-sm text-gray-400">Manuelle Integration durch Tech-Experten</div>
                                    </div>
                                </div>
                                <div class="flex items-start space-x-3">
                                    <div class="bg-complyo-secondary w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold text-white mt-1">4</div>
                                    <div>
                                        <div class="font-medium">Laufende Betreuung</div>
                                        <div class="text-sm text-gray-400">Quartalsweise Reviews + KI-Monitoring</div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-blue-500/10 rounded-lg p-3 mt-4">
                                <div class="text-sm text-complyo-secondary font-medium">
                                    <i class="fas fa-calendar mr-2"></i>Setup in 1-2 Wochen
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    
        <!-- Testimonials / Success Stories -->
        <section class="py-20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-16">
                    <h2 class="text-4xl font-bold mb-4">Erfolgsgeschichten</h2>
                    <p class="text-xl text-gray-300">Wie Complyo Unternehmen vor teuren Abmahnungen bewahrt hat</p>
                </div>
                
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="bg-complyo-gray/50 rounded-2xl p-8 border border-complyo-primary/20">
                        <div class="flex items-center mb-6">
                            <div class="w-12 h-12 bg-gradient-to-r from-complyo-primary to-complyo-secondary rounded-full flex items-center justify-center text-white font-bold text-xl mr-4">
                                TM
                            </div>
                            <div>
                                <div class="font-bold">TechMax GmbH</div>
                                <div class="text-sm text-gray-400">E-Commerce</div>
                            </div>
                        </div>
                        <p class="text-gray-300 mb-6">
                            "Nach einer Abmahnung über 8.500€ haben wir Complyo beauftragt. Die KI hat in 18 Stunden alle kritischen Issues behoben. Seitdem keine weiteren Abmahnungen!"
                        </p>
                        <div class="flex items-center justify-between text-sm">
                            <div class="text-green-400 font-medium">
                                <i class="fas fa-arrow-up mr-1"></i>Score: 23 → 96
                            </div>
                            <div class="text-complyo-accent">
                                KI-Plan
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-complyo-gray/50 rounded-2xl p-8 border border-complyo-secondary/20">
                        <div class="flex items-center mb-6">
                            <div class="w-12 h-12 bg-gradient-to-r from-complyo-secondary to-complyo-accent rounded-full flex items-center justify-center text-white font-bold text-xl mr-4">
                                MS
                            </div>
                            <div>
                                <div class="font-bold">MedSafe Praxis</div>
                                <div class="text-sm text-gray-400">Healthcare</div>
                            </div>
                        </div>
                        <p class="text-gray-300 mb-6">
                            "Als Arztpraxis haben wir besondere Compliance-Anforderungen. Der Experten-Service hat eine individuelle Lösung entwickelt. Perfekt umgesetzt!"
                        </p>
                        <div class="flex items-center justify-between text-sm">
                            <div class="text-green-400 font-medium">
                                <i class="fas fa-arrow-up mr-1"></i>Score: 31 → 98
                            </div>
                            <div class="text-complyo-secondary">
                                Experten-Plan
                            </div>
                        </div>
                    </div>


























                    # COMPLYO BACKEND ERWEITERUNG
                    # /opt/projects/saas-project-2/legal/backend/
                    
                    # 1. DATABASE MODELS erweitern
                    # models.py
                    from sqlalchemy import Column, String, Integer, Boolean, DateTime, Text, JSON, ForeignKey, UUID
                    from sqlalchemy.ext.declarative import declarative_base
                    from sqlalchemy.orm import relationship
                    from sqlalchemy.dialects.postgresql import UUID as PG_UUID
                    import uuid
                    from datetime import datetime
                    
                    Base = declarative_base()
                    
                    class User(Base):
                        __tablename__ = "users"
                        
                        id = Column(PG_UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
                        email = Column(String(255), unique=True, nullable=False)
                        name = Column(String(255))
                        plan_type = Column(String(50), nullable=False)  # 'ai' or 'expert'
                        subscription_status = Column(String(50), default='active')
                        stripe_customer_id = Column(String(255))
                        auth_token = Column(Text)  # JWT token
                        created_at = Column(DateTime, default=datetime.utcnow)
                        updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
                        
                        # Relationships
                        projects = relationship("Project", back_populates="user")
                        leads = relationship("Lead", back_populates="user")
                    
                    class Lead(Base):
                        __tablename__ = "leads"
                        
                        id = Column(PG_UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
                        email = Column(String(255), nullable=False)
                        website_url = Column(String(500), nullable=False)
                        source = Column(String(100), default='landing_page')
                        status = Column(String(50), default='new')  # new, contacted, converted, lost
                        checkout_token = Column(String(255))
                        latest_analysis_id = Column(PG_UUID(as_uuid=True), ForeignKey('analyses.id'))
                        user_id = Column(PG_UUID(as_uuid=True), ForeignKey('users.id'), nullable=True)
                        created_at = Column(DateTime, default=datetime.utcnow)
                        
                        # Relationships
                        user = relationship("User", back_populates="leads")
                        analyses = relationship("Analysis", back_populates="lead")
                    
                    class Project(Base):
                        __tablename__ = "projects"
                        
                        id = Column(PG_UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
                        user_id = Column(PG_UUID(as_uuid=True), ForeignKey('users.id'), nullable=False)
                        website_url = Column(String(500), nullable=False)
                        project_name = Column(String(255))
                        status = Column(String(50), default='analyzing')  # analyzing, fixing, completed, monitoring
                        current_score = Column(Integer, default=0)
                        target_score = Column(Integer, default=95)
                        created_at = Column(DateTime, default=datetime.utcnow)
                        updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
                        
                        # Relationships
                        user = relationship("User", back_populates="projects")
                        analyses = relationship("Analysis", back_populates="project")
                        issues = relationship("ComplianceIssue", back_populates="project")
                    
                    class Analysis(Base):
                        __tablename__ = "analyses"
                        
                        id = Column(PG_UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
                        project_id = Column(PG_UUID(as_uuid=True), ForeignKey('projects.id'), nullable=True)
                        lead_id = Column(PG_UUID(as_uuid=True), ForeignKey('leads.id'), nullable=True)
                        analysis_data = Column(JSON, nullable=False)
                        overall_score = Column(Integer, nullable=False)
                        total_issues = Column(Integer, nullable=False)
                        scan_timestamp = Column(DateTime, default=datetime.utcnow)
                        analysis_type = Column(String(50), default='full')  # full, quick, monitoring
                        
                        # Relationships
                        project = relationship("Project", back_populates="analyses")
                        lead = relationship("Lead", back_populates="analyses")
                        issues = relationship("ComplianceIssue", back_populates="analysis")
                    
                    class ComplianceIssue(Base):
                        __tablename__ = "compliance_issues"
                        
                        id = Column(PG_UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
                        project_id = Column(PG_UUID(as_uuid=True), ForeignKey('projects.id'), nullable=False)
                        analysis_id = Column(PG_UUID(as_uuid=True), ForeignKey('analyses.id'), nullable=False)
                        category = Column(String(100), nullable=False)  # impressum, datenschutz, cookies, accessibility
                        severity = Column(String(50), nullable=False)   # critical, high, medium, low
                        status = Column(String(50), default='open')     # open, in_progress, fixed, verified
                        title = Column(String(255), nullable=False)
                        description = Column(Text)
                        fix_instructions = Column(Text)
                        ai_fix_available = Column(Boolean, default=False)
                        estimated_fix_time = Column(Integer)  # in minutes
                        created_at = Column(DateTime, default=datetime.utcnow)
                        updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
                        
                        # Relationships
                        project = relationship("Project", back_populates="issues")
                        analysis = relationship("Analysis", back_populates="issues")
                        fix_tasks = relationship("FixTask", back_populates="issue")
                    
                    class FixTask(Base):
                        __tablename__ = "fix_tasks"
                        
                        id = Column(PG_UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
                        issue_id = Column(PG_UUID(as_uuid=True), ForeignKey('compliance_issues.id'), nullable=False)
                        task_type = Column(String(50), nullable=False)  # ai_fix, expert_review, expert_implementation
                        status = Column(String(50), default='pending')  # pending, in_progress, completed, failed
                        assigned_to = Column(String(255))
                        fix_data = Column(JSON)
                        completion_notes = Column(Text)
                        created_at = Column(DateTime, default=datetime.utcnow)
                        completed_at = Column(DateTime)
                        
                        # Relationships
                        issue = relationship("ComplianceIssue", back_populates="fix_tasks")
                    
                    # 2. ERWEITERTE API ENDPOINTS
                    # main.py Erweiterungen
                    from fastapi import FastAPI, HTTPException, Depends, BackgroundTasks
                    from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
                    from sqlalchemy.orm import Session
                    from pydantic import BaseModel, EmailStr
                    import jwt
                    import stripe
                    import secrets
                    from typing import Optional, List
                    
                    app = FastAPI(title="Complyo API", version="2.0.0")
                    
                    # Database connection
                    from sqlalchemy import create_engine
                    from sqlalchemy.orm import sessionmaker
                    
                    DATABASE_URL = "postgresql://complyo_user:WrsmZTXYcjt0c7lt%2FlOzEnX1N5rtjRklLYrY8zXmBGo%3D@shared-postgres:5432/complyo_db"
                    engine = create_engine(DATABASE_URL)
                    SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)
                    
                    def get_db():
                        db = SessionLocal()
                        try:
                            yield db
                        finally:
                            db.close()
                    
                    # Pydantic Models
                    class AnalysisRequest(BaseModel):
                        url: str
                        email: EmailStr
                        lead_source: str = "landing_page"
                    
                    class CheckoutRequest(BaseModel):
                        checkout_token: str
                        plan_type: str  # 'ai' or 'expert'
                    
                    class OnboardingRequest(BaseModel):
                        session_id: str
                    
                    # Auth Helper
                    security = HTTPBearer()
                    
                    def get_current_user(credentials: HTTPAuthorizationCredentials = Depends(security), db: Session = Depends(get_db)):
                        try:
                            payload = jwt.decode(credentials.credentials, settings.JWT_SECRET, algorithms=["HS256"])
                            user_id = payload.get("user_id")
                            user = db.query(User).filter(User.id == user_id).first()
                            if not user:
                                raise HTTPException(401, "Invalid token")
                            return user
                        except jwt.ExpiredSignatureError:
                            raise HTTPException(401, "Token expired")
                    
                    # === ENHANCED LANDING PAGE ENDPOINT ===
                    @app.post("/api/analyze")
                    async def analyze_website_with_lead(request: AnalysisRequest, background_tasks: BackgroundTasks, db: Session = Depends(get_db)):
                        """Enhanced website analysis with lead tracking"""
                        
                        # 1. Perform website analysis (existing logic)
                        from compliance_engine import ComplianceEngine
                        compliance_engine = ComplianceEngine()
                        analysis_result = await compliance_engine.analyze_website(request.url)
                        
                        # 2. Create or update lead
                        existing_lead = db.query(Lead).filter(Lead.email == request.email).first()
                        
                        if existing_lead:
                            lead = existing_lead
                            lead.website_url = request.url
                            lead.status = 'contacted'
                        else:
                            lead = Lead(
                                email=request.email,
                                website_url=request.url,
                                source=request.lead_source,
                                status='new'
                            )
                            db.add(lead)
                        
                        # 3. Save analysis
                        analysis = Analysis(
                            lead_id=lead.id,
                            analysis_data=analysis_result,
                            overall_score=analysis_result.get('overall_score', 0),
                            total_issues=analysis_result.get('total_issues', 0),
                            analysis_type='landing_page'
                        )
                        db.add(analysis)
                        db.commit()
                        
                        # 4. Generate checkout token
                        checkout_token = secrets.token_urlsafe(32)
                        lead.checkout_token = checkout_token
                        lead.latest_analysis_id = analysis.id
                        db.commit()
                        
                        # 5. Background: Send email with detailed report
                        background_tasks.add_task(send_analysis_email, request.email, analysis_result, checkout_token)
                        
                        return {
                            **analysis_result,
                            "lead_id": str(lead.id),
                            "analysis_id": str(analysis.id),
                            "checkout_token": checkout_token,
                            "estimated_risk_euro": calculate_risk_in_euro(analysis_result)
                        }
                    
                    # === CHECKOUT & PAYMENT ===
                    @app.post("/api/checkout/create-session")
                    async def create_checkout_session(request: CheckoutRequest, db: Session = Depends(get_db)):
                        """Create Stripe checkout session"""
                        
                        # Load lead by token
                        lead = db.query(Lead).filter(Lead.checkout_token == request.checkout_token).first()
                        if not lead:
                            raise HTTPException(404, "Invalid checkout token")
                        
                        # Get analysis data
                        analysis = db.query(Analysis).filter(Analysis.id == lead.latest_analysis_id).first()
                        
                        # Stripe price IDs (configure in settings)
                        price_ids = {
                            'ai': 'price_ai_monthly_39eur',  # zu erstellen in Stripe
                            'expert': 'price_expert_setup_2000eur'  # zu erstellen in Stripe
                        }
                        
                        # Create Stripe session
                        stripe.api_key = settings.STRIPE_SECRET_KEY
                        
                        session = stripe.checkout.Session.create(
                            payment_method_types=['card', 'sepa_debit'],
                            mode='subscription' if request.plan_type == 'ai' else 'payment',
                            line_items=[{
                                'price': price_ids[request.plan_type],
                                'quantity': 1,
                            }],
                            metadata={
                                'lead_id': str(lead.id),
                                'analysis_id': str(lead.latest_analysis_id),
                                'plan_type': request.plan_type,
                                'website_url': lead.website_url
                            },
                            customer_email=lead.email,
                            success_url='https://app.complyo.tech/onboarding?session_id={CHECKOUT_SESSION_ID}',
                            cancel_url='https://complyo.tech?cancelled=true',
                        )
                        
                        return {"checkout_url": session.url}
                    
                    # === ONBOARDING ===
                    @app.post("/api/onboarding/complete")
                    async def complete_onboarding(request: OnboardingRequest, background_tasks: BackgroundTasks, db: Session = Depends(get_db)):
                        """Complete onboarding after successful payment"""
                        
                        # Verify Stripe session
                        stripe.api_key = settings.STRIPE_SECRET_KEY
                        session = stripe.checkout.Session.retrieve(request.session_id)
                        
                        if session.payment_status != 'paid':
                            raise HTTPException(400, "Payment not completed")
                        
                        # Get lead data
                        lead_id = session.metadata['lead_id']
                        lead = db.query(Lead).filter(Lead.id == lead_id).first()
                        
                        # Create or get user
                        existing_user = db.query(User).filter(User.email == lead.email).first()
                        
                        if existing_user:
                            user = existing_user
                            user.plan_type = session.metadata['plan_type']
                            user.subscription_status = 'active'
                            user.stripe_customer_id = session.customer
                        else:
                            user = User(
                                email=lead.email,
                                plan_type=session.metadata['plan_type'],
                                subscription_status='active',
                                stripe_customer_id=session.customer
                            )
                            db.add(user)
                        
                        # Create project with analysis data
                        project = Project(
                            user_id=user.id,
                            website_url=session.metadata['website_url'],
                            project_name=f"Website: {session.metadata['website_url']}",
                            status='analyzing'
                        )
                        db.add(project)
                        db.commit()
                        
                        # Link analysis to project
                        analysis = db.query(Analysis).filter(Analysis.id == session.metadata['analysis_id']).first()
                        analysis.project_id = project.id
                        
                        # Create compliance issues from analysis
                        create_issues_from_analysis(analysis, project, db)
                        
                        # Update lead status
                        lead.status = 'converted'
                        lead.user_id = user.id
                        db.commit()
                        
                        # Generate JWT token
                        auth_token = jwt.encode(
                            {"user_id": str(user.id), "email": user.email},
                            settings.JWT_SECRET,
                            algorithm="HS256"
                        )
                        user.auth_token = auth_token
                        db.commit()
                        
                        # Initialize plan-specific workflow
                        if session.metadata['plan_type'] == 'ai':
                            background_tasks.add_task(initialize_ai_fixes, project.id)
                        else:
                            background_tasks.add_task(schedule_expert_consultation, project.id, user.email)
                        
                        return {
                            "auth_token": auth_token,
                            "user_id": str(user.id),
                            "project_id": str(project.id),
                            "plan_type": user.plan_type,
                            "redirect_url": f"https://app.complyo.tech/dashboard?project={project.id}"
                        }
                    
                    # === DASHBOARD ENDPOINTS ===
                    @app.get("/api/dashboard/overview")
                    async def get_dashboard_overview(current_user: User = Depends(get_current_user), db: Session = Depends(get_db)):
                        """Dashboard overview with all user projects"""
                        
                        projects = db.query(Project).filter(Project.user_id == current_user.id).all()
                        
                        dashboard_data = {
                            "user": {
                                "email": current_user.email,
                                "plan_type": current_user.plan_type,
                                "subscription_status": current_user.subscription_status
                            },
                            "projects": []
                        }
                        
                        for project in projects:
                            # Get latest analysis
                            latest_analysis = db.query(Analysis).filter(
                                Analysis.project_id == project.id
                            ).order_by(Analysis.scan_timestamp.desc()).first()
                            
                            # Count open issues
                            open_issues = db.query(ComplianceIssue).filter(
                                ComplianceIssue.project_id == project.id,
                                ComplianceIssue.status == 'open'
                            ).count()
                            
                            # Calculate progress
                            total_issues = db.query(ComplianceIssue).filter(
                                ComplianceIssue.project_id == project.id
                            ).count()
                            
                            fixed_issues = db.query(ComplianceIssue).filter(
                                ComplianceIssue.project_id == project.id,
                                ComplianceIssue.status == 'fixed'
                            ).count()
                            
                            progress = (fixed_issues / total_issues * 100) if total_issues > 0 else 0
                            
                            project_data = {
                                "id": str(project.id),
                                "website_url": project.website_url,
                                "project_name": project.project_name,
                                "status": project.status,
                                "current_score": latest_analysis.overall_score if latest_analysis else 0,
                                "target_score": project.target_score,
                                "progress_percentage": round(progress, 1),
                                "open_issues": open_issues,
                                "total_issues": total_issues,
                                "last_scan": latest_analysis.scan_timestamp if latest_analysis else None,
                                "created_at": project.created_at
                            }
                            
                            dashboard_data["projects"].append(project_data)
                        
                        return dashboard_data
                    
                    @app.get("/api/project/{project_id}")
                    async def get_project_details(
                        project_id: str, 
                        current_user: User = Depends(get_current_user), 
                        db: Session = Depends(get_db)
                    ):
                        """Detailed project view with issues and fixes"""
                        
                        # Verify project ownership
                        project = db.query(Project).filter(
                            Project.id == project_id,
                            Project.user_id == current_user.id
                        ).first()
                        
                        if not project:
                            raise HTTPException(404, "Project not found")
                        
                        # Get latest analysis
                        latest_analysis = db.query(Analysis).filter(
                            Analysis.project_id == project_id
                        ).order_by(Analysis.scan_timestamp.desc()).first()
                        
                        # Get all issues
                        issues = db.query(ComplianceIssue).filter(
                            ComplianceIssue.project_id == project_id
                        ).order_by(ComplianceIssue.severity.desc(), ComplianceIssue.created_at).all()
                        
                        # Get active fix tasks
                        fix_tasks = db.query(FixTask).join(ComplianceIssue).filter(
                            ComplianceIssue.project_id == project_id,
                            FixTask.status.in_(['pending', 'in_progress'])
                        ).all()
                        
                        # Get progress history (last 30 days)
                        from datetime import datetime, timedelta
                        thirty_days_ago = datetime.utcnow() - timedelta(days=30)
                        
                        progress_history = db.query(Analysis).filter(
                            Analysis.project_id == project_id,
                            Analysis.scan_timestamp >= thirty_days_ago
                        ).order_by(Analysis.scan_timestamp).all()
                        
                        return {
                            "project": {
                                "id": str(project.id),
                                "website_url": project.website_url,
                                "project_name": project.project_name,
                                "status": project.status,
                                "current_score": latest_analysis.overall_score if latest_analysis else 0,
                                "target_score": project.target_score,
                                "created_at": project.created_at
                            },
                            "latest_analysis": {
                                "id": str(latest_analysis.id),
                                "overall_score": latest_analysis.overall_score,
                                "total_issues": latest_analysis.total_issues,
                                "scan_timestamp": latest_analysis.scan_timestamp,
                                "analysis_data": latest_analysis.analysis_data
                            } if latest_analysis else None,
                            "issues": [
                                {
                                    "id": str(issue.id),
                                    "category": issue.category,
                                    "severity": issue.severity,
                                    "status": issue.status,
                                    "title": issue.title,
                                    "description": issue.description,
                                    "ai_fix_available": issue.ai_fix_available,
                                    "estimated_fix_time": issue.estimated_fix_time,
                                    "created_at": issue.created_at
                                } for issue in issues
                            ],
                            "active_fix_tasks": [
                                {
                                    "id": str(task.id),
                                    "issue_id": str(task.issue_id),
                                    "task_type": task.task_type,
                                    "status": task.status,
                                    "assigned_to": task.assigned_to,
                                    "created_at": task.created_at
                                } for task in fix_tasks
                            ],
                            "progress_history": [
                                {
                                    "date": analysis.scan_timestamp,
                                    "score": analysis.overall_score,
                                    "issues": analysis.total_issues
                                } for analysis in progress_history
                            ]
                        }
                    
                    # === AI AUTOMATION ENDPOINTS ===
                    @app.post("/api/ai/start-fixes/{project_id}")
                    async def start_ai_fixes(
                        project_id: str,
                        background_tasks: BackgroundTasks,
                        current_user: User = Depends(get_current_user),
                        db: Session = Depends(get_db)
                    ):
                        """Start AI-powered fixes for project issues"""
                        
                        # Verify project ownership and plan
                        project = db.query(Project).filter(
                            Project.id == project_id,
                            Project.user_id == current_user.id
                        ).first()
                        
                        if not project:
                            raise HTTPException(404, "Project not found")
                        
                        if current_user.plan_type != 'ai':
                            raise HTTPException(403, "AI fixes require AI subscription plan")
                        
                        # Get fixable issues
                        fixable_issues = db.query(ComplianceIssue).filter(
                            ComplianceIssue.project_id == project_id,
                            ComplianceIssue.status == 'open',
                            ComplianceIssue.ai_fix_available == True
                        ).all()
                        
                        # Create AI fix tasks
                        tasks_created = 0
                        for issue in fixable_issues:
                            fix_task = FixTask(
                                issue_id=issue.id,
                                task_type='ai_fix',
                                status='pending',
                                assigned_to='AI System'
                            )
                            db.add(fix_task)
                            tasks_created += 1
                        
                        db.commit()
                        
                        # Update project status
                        project.status = 'fixing'
                        db.commit()
                        
                        # Start AI processing in background
                        background_tasks.add_task(process_ai_fixes, project_id)
                        
                        return {
                            "message": "AI fixes started",
                            "tasks_created": tasks_created,
                            "estimated_completion": "2-4 hours"
                        }
                    
                    @app.get("/api/ai/progress/{project_id}")
                    async def get_ai_progress(
                        project_id: str,
                        current_user: User = Depends(get_current_user),
                        db: Session = Depends(get_db)
                    ):
                        """Get AI fix progress for project"""
                        
                        # Verify ownership
                        project = db.query(Project).filter(
                            Project.id == project_id,
                            Project.user_id == current_user.id
                        ).first()
                        
                        if not project:
                            raise HTTPException(404, "Project not found")
                        
                        # Get AI fix tasks
                        ai_tasks = db.query(FixTask).join(ComplianceIssue).filter(
                            ComplianceIssue.project_id == project_id,
                            FixTask.task_type == 'ai_fix'
                        ).all()
                        
                        total_tasks = len(ai_tasks)
                        completed_tasks = len([t for t in ai_tasks if t.status == 'completed'])
                        in_progress_tasks = len([t for t in ai_tasks if t.status == 'in_progress'])
                        failed_tasks = len([t for t in ai_tasks if t.status == 'failed'])
                        
                        progress_percentage = (completed_tasks / total_tasks * 100) if total_tasks > 0 else 0
                        
                        return {
                            "total_tasks": total_tasks,
                            "completed_tasks": completed_tasks,
                            "in_progress_tasks": in_progress_tasks,
                            "failed_tasks": failed_tasks,
                            "progress_percentage": round(progress_percentage, 1),
                            "status": project.status,
                            "tasks": [
                                {
                                    "id": str(task.id),
                                    "issue_title": task.issue.title,
                                    "status": task.status,
                                    "completion_notes": task.completion_notes,
                                    "created_at": task.created_at,
                                    "completed_at": task.completed_at
                                } for task in ai_tasks
                            ]
                        }
                    
                    # === EXPERT SERVICE ENDPOINTS ===
                    @app.post("/api/expert/schedule/{project_id}")
                    async def schedule_expert_consultation(
                        project_id: str,
                        current_user: User = Depends(get_current_user),
                        db: Session = Depends(get_db)
                    ):
                        """Schedule expert consultation via Calendly"""
                        
                        # Verify project and plan
                        project = db.query(Project).filter(
                            Project.id == project_id,
                            Project.user_id == current_user.id
                        ).first()
                        
                        if not project:
                            raise HTTPException(404, "Project not found")
                        
                        if current_user.plan_type != 'expert':
                            raise HTTPException(403, "Expert consultation requires expert plan")
                        
                        # Generate Calendly link with project context
                        calendly_link = generate_calendly_link(
                            user_email=current_user.email,
                            project_id=project_id,
                            website_url=project.website_url
                        )
                        
                        return {
                            "calendly_booking_url": calendly_link,
                            "project_id": project_id,
                            "message": "Please book your expert consultation"
                        }
                    
                    # === HELPER FUNCTIONS ===
                    def create_issues_from_analysis(analysis: Analysis, project: Project, db: Session):
                        """Create ComplianceIssue records from analysis results"""
                        
                        analysis_data = analysis.analysis_data
                        
                        for result in analysis_data.get('results', []):
                            severity = 'critical' if result.get('status') == 'fail' else 'medium'
                            
                            issue = ComplianceIssue(
                                project_id=project.id,
                                analysis_id=analysis.id,
                                category=result.get('category', 'general'),
                                severity=severity,
                                title=result.get('message', 'Compliance Issue'),
                                description=str(result.get('details', {})),
                                ai_fix_available=is_ai_fixable(result.get('category')),
                                estimated_fix_time=estimate_fix_time(result.get('category'))
                            )
                            db.add(issue)
                        
                        db.commit()
                    
                    def is_ai_fixable(category: str) -> bool:
                        """Determine if issue category can be fixed by AI"""
                        ai_fixable_categories = ['impressum', 'datenschutz', 'cookies', 'accessibility']
                        return category.lower() in ai_fixable_categories
                    
                    def estimate_fix_time(category: str) -> int:
                        """Estimate fix time in minutes based on category"""
                        time_estimates = {
                            'impressum': 30,
                            'datenschutz': 45,
                            'cookies': 60,
                            'accessibility': 90,
                            'general': 20
                        }
                        return time_estimates.get(category.lower(), 30)
                    
                    def calculate_risk_in_euro(analysis_result: dict) -> dict:
                        """Calculate potential fine/risk in euros"""
                        total_issues = analysis_result.get('total_issues', 0)
                        score = analysis_result.get('overall_score', 100)
                        
                        if score < 30:
                            risk_min, risk_max = 8000, 20000
                        elif score < 50:
                            risk_min, risk_max = 4000, 12000
                        elif score < 70:
                            risk_min, risk_max = 1000, 6000
                        else:
                            risk_min, risk_max = 200, 2000
                        
                        return {
                            "min_risk": risk_min,
                            "max_risk": risk_max,
                            "risk_level": "Hoch" if score < 50 else "Mittel" if score < 75 else "Niedrig"
                        }
                    
                    def generate_calendly_link(user_email: str, project_id: str, website_url: str) -> str:
                        """Generate Calendly booking link with project context"""
                        import urllib.parse
                        
                        # Calendly event type for compliance consultations
                        calendly_event_type = "https://calendly.com/complyo-experts/compliance-consultation"
                        
                        # Add project context as URL parameters
                        params = {
                            'a1': user_email,
                            'a2': project_id,
                            'a3': website_url,
                            'name': 'Compliance Consultation'
                        }
                        
                        query_string = urllib.parse.urlencode(params)
                        return f"{calendly_event_type}?{query_string}"
                    
                    # === BACKGROUND TASKS ===
                    async def initialize_ai_fixes(project_id: str):
                        """Background task: Initialize AI fixes for new AI plan customer"""
                        from ai_automation import AIComplianceEngine
                        
                        ai_engine = AIComplianceEngine()
                        await ai_engine.start_project_automation(project_id)
                    
                    async def process_ai_fixes(project_id: str):
                        """Background task: Process AI fixes"""
                        from ai_automation import AIComplianceEngine
                        
                        ai_engine = AIComplianceEngine()
                        await ai_engine.process_project_fixes(project_id)
                    
                    async def schedule_expert_consultation(project_id: str, user_email: str):
                        """Background task: Send expert consultation booking info"""
                        from email_service import send_expert_welcome_email
                        
                        await send_expert_welcome_email(user_email, project_id)
                    
                    async def send_analysis_email(email: str, analysis_result: dict, checkout_token: str):
                        """Background task: Send detailed analysis report via email"""
                        from email_service import send_analysis_report
                        
                        await send_analysis_report(email, analysis_result, checkout_token)
                    
                    # === MONITORING & MAINTENANCE ===
                    @app.post("/api/admin/trigger-scan/{project_id}")
                    async def trigger_manual_scan(
                        project_id: str,
                        background_tasks: BackgroundTasks,
                        current_user: User = Depends(get_current_user),
                        db: Session = Depends(get_db)
                    ):
                        """Manually trigger website re-scan"""
                        
                        project = db.query(Project).filter(
                            Project.id == project_id,
                            Project.user_id == current_user.id
                        ).first()
                        
                        if not project:
                            raise HTTPException(404, "Project not found")
                        
                        # Start background scan
                        background_tasks.add_task(perform_website_rescan, project_id)
                        
                        return {"message": "Re-scan initiated", "project_id": project_id}
                    
                    async def perform_website_rescan(project_id: str):
                        """Background task: Re-scan website and update analysis"""
                        from compliance_engine import ComplianceEngine
                        
                        db = SessionLocal()
                        try:
                            project = db.query(Project).filter(Project.id == project_id).first()
                            
                            compliance_engine = ComplianceEngine()
                            new_analysis_data = await compliance_engine.analyze_website(project.website_url)
                            
                            # Save new analysis
                            new_analysis = Analysis(
                                project_id=project.id,
                                analysis_data=new_analysis_data,
                                overall_score=new_analysis_data.get('overall_score', 0),
                                total_issues=new_analysis_data.get('total_issues', 0),
                                analysis_type='monitoring'
                            )
                            db.add(new_analysis)
                            
                            # Update project score
                            project.current_score = new_analysis_data.get('overall_score', 0)
                            db.commit()
                            
                            # Check for new issues
                            create_issues_from_analysis(new_analysis, project, db)
                            
                        finally:
                            db.close()
                    
                    # Database initialization
                    def create_tables():
                        """Create all database tables"""
                        Base.metadata.create_all(bind=engine)
                    
                    if __name__ == "__main__":
                        create_tables()
                        print("Database tables created successfully!")














                        # COMPLYO KI-AUTOMATION ENGINE
                        # /opt/projects/saas-project-2/legal/backend/ai_automation.py
                        
                        import asyncio
                        import aiohttp
                        from openai import AsyncOpenAI
                        from anthropic import AsyncAnthropic
                        from sqlalchemy.orm import sessionmaker
                        from sqlalchemy import create_engine
                        from models import Project, ComplianceIssue, FixTask, Analysis, SessionLocal
                        from datetime import datetime
                        import json
                        import logging
                        
                        # Setup logging
                        logging.basicConfig(level=logging.INFO)
                        logger = logging.getLogger(__name__)
                        
                        class AIComplianceEngine:
                            def __init__(self):
                                self.openai_client = AsyncOpenAI(api_key=settings.OPENAI_API_KEY)
                                self.claude_client = AsyncAnthropic(api_key=settings.ANTHROPIC_API_KEY)
                                self.session_local = SessionLocal
                                
                            async def start_project_automation(self, project_id: str):
                                """Initialize AI automation for new project"""
                                logger.info(f"Starting AI automation for project {project_id}")
                                
                                db = self.session_local()
                                try:
                                    project = db.query(Project).filter(Project.id == project_id).first()
                                    if not project:
                                        logger.error(f"Project {project_id} not found")
                                        return
                                    
                                    # Update project status
                                    project.status = 'ai_analyzing'
                                    db.commit()
                                    
                                    # Start automated fixes
                                    await self.process_project_fixes(project_id)
                                    
                                finally:
                                    db.close()
                            
                            async def process_project_fixes(self, project_id: str):
                                """Process all AI fixes for a project"""
                                logger.info(f"Processing AI fixes for project {project_id}")
                                
                                db = self.session_local()
                                try:
                                    # Get all pending AI fix tasks
                                    pending_tasks = db.query(FixTask).join(ComplianceIssue).filter(
                                        ComplianceIssue.project_id == project_id,
                                        FixTask.task_type == 'ai_fix',
                                        FixTask.status == 'pending'
                                    ).all()
                                    
                                    logger.info(f"Found {len(pending_tasks)} pending AI fix tasks")
                                    
                                    # Process each task
                                    for task in pending_tasks:
                                        await self.process_single_fix_task(task.id, db)
                                    
                                    # After all fixes: trigger re-scan
                                    await self.trigger_post_fix_rescan(project_id)
                                    
                                finally:
                                    db.close()
                            
                            async def process_single_fix_task(self, task_id: str, db):
                                """Process individual AI fix task"""
                                task = db.query(FixTask).filter(FixTask.id == task_id).first()
                                if not task:
                                    return
                                
                                # Update task status
                                task.status = 'in_progress'
                                db.commit()
                                
                                try:
                                    issue = task.issue
                                    project = issue.project
                                    
                                    logger.info(f"Processing {issue.category} fix for {project.website_url}")
                                    
                                    # Route to appropriate AI fix method
                                    if issue.category == 'impressum':
                                        fix_result = await self.generate_impressum_fix(project, issue)
                                    elif issue.category == 'datenschutz':
                                        fix_result = await self.generate_privacy_policy_fix(project, issue)
                                    elif issue.category == 'cookies':
                                        fix_result = await self.implement_cookie_compliance_fix(project, issue)
                                    elif issue.category == 'accessibility':
                                        fix_result = await self.fix_accessibility_issues(project, issue)
                                    else:
                                        fix_result = await self.generate_generic_fix(project, issue)
                                    
                                    # Save fix result
                                    task.fix_data = fix_result
                                    task.completion_notes = f"AI fix completed successfully"
                                    task.status = 'completed'
                                    task.completed_at = datetime.utcnow()
                                    
                                    # Update issue status
                                    issue.status = 'fixed'
                                    
                                    db.commit()
                                    
                                    logger.info(f"Successfully completed fix for issue {issue.id}")
                                    
                                except Exception as e:
                                    logger.error(f"AI fix failed for task {task_id}: {str(e)}")
                                    
                                    task.status = 'failed'
                                    task.completion_notes = f"AI fix failed: {str(e)}"
                                    db.commit()
                            
                            async def generate_impressum_fix(self, project: Project, issue: ComplianceIssue):
                                """Generate complete German Impressum using GPT-4"""
                                
                                # Analyze website to extract business info
                                website_info = await self.extract_website_info(project.website_url)
                                
                                prompt = f"""
                                Erstelle ein vollständiges, rechtssicheres Impressum nach deutschem Recht (TMG §5) für folgende Website:
                        
                                Website: {project.website_url}
                                Erkannte Informationen: {json.dumps(website_info, indent=2)}
                        
                                ANFORDERUNGEN:
                                - Vollständige Anbieterkennzeichnung nach TMG §5
                                - DSGVO-konforme Kontaktdaten
                                - Branchen-spezifische Pflichtangaben (falls erkennbar)
                                - Aktuelle deutsche Rechtsprechung berücksichtigen
                                - Umsatzsteuer-ID falls Unternehmen erkennbar
                                - Aufsichtsbehörde falls regulierte Branche
                                - Streitschlichtung nach EU-ODR-Verordnung
                        
                                FORMAT:
                                - HTML-Code für direkte Integration
                                - Strukturiert mit <h2>, <p>, <address> Tags
                                - Responsive und barrierefrei
                                - Deutsche Sprache
                        
                                Generiere nur den HTML-Code ohne Erklärungen.
                                """
                                
                                response = await self.openai_client.chat.completions.create(
                                    model="gpt-4-turbo",
                                    messages=[
                                        {"role": "system", "content": "Du bist ein Experte für deutsches Internetrecht und DSGVO-Compliance."},
                                        {"role": "user", "content": prompt}
                                    ],
                                    temperature=0.1,
                                    max_tokens=2000
                                )
                                
                                generated_html = response.choices[0].message.content
                                
                                return {
                                    "fix_type": "impressum_generation",
                                    "generated_content": generated_html,
                                    "implementation_method": "html_injection",
                                    "target_location": "/impressum",
                                    "backup_location": "footer",
                                    "instructions": "Impressum-HTML in Footer und/oder separate /impressum Seite einbinden",
                                    "compliance_notes": "TMG §5 konform, DSGVO-berücksichtigt"
                                }
                            
                            async def generate_privacy_policy_fix(self, project: Project, issue: ComplianceIssue):
                                """Generate DSGVO-compliant privacy policy"""
                                
                                # Analyze website for data processing activities
                                data_processing = await self.analyze_data_processing(project.website_url)
                                
                                prompt = f"""
                                Erstelle eine vollständige DSGVO-konforme Datenschutzerklärung für:
                        
                                Website: {project.website_url}
                                Erkannte Datenverarbeitung: {json.dumps(data_processing, indent=2)}
                        
                                DSGVO-ANFORDERUNGEN (Art. 13, 14):
                                - Verantwortlicher und Kontaktdaten
                                - Zwecke und Rechtsgrundlagen der Verarbeitung
                                - Kategorien personenbezogener Daten
                                - Empfänger oder Kategorien von Empfängern
                                - Drittlandübermittlung (falls vorhanden)
                                - Speicherdauer oder Kriterien
                                - Betroffenenrechte (Art. 15-22 DSGVO)
                                - Widerrufsrecht bei Einwilligung
                                - Beschwerderecht bei Aufsichtsbehörde
                                - Automatisierte Entscheidungsfindung
                        
                                TECHNISCHE INTEGRATION:
                                - Analytics (Google Analytics, etc.)
                                - Social Media Plugins
                                - Contact Forms
                                - Cookies und Tracking
                                - Newsletter/Marketing
                        
                                Erstelle eine vollständige, deutsche Datenschutzerklärung als HTML.
                                """
                                
                                response = await self.openai_client.chat.completions.create(
                                    model="gpt-4-turbo",
                                    messages=[
                                        {"role": "system", "content": "Du bist ein DSGVO-Experte und Datenschutzbeauftragter."},
                                        {"role": "user", "content": prompt}
                                    ],
                                    temperature=0.1,
                                    max_tokens=4000
                                )
                                
                                privacy_policy_html = response.choices[0].message.content
                                
                                return {
                                    "fix_type": "privacy_policy_generation",
                                    "generated_content": privacy_policy_html,
                                    "implementation_method": "html_page",
                                    "target_location": "/datenschutz",
                                    "link_locations": ["footer", "contact_form", "newsletter_signup"],
                                    "instructions": "Datenschutzerklärung als separate Seite implementieren und von allen Formularen verlinken",
                                    "compliance_notes": "DSGVO Art. 13/14 konform, deutsche Aufsichtsbehörden berücksichtigt"
                                }
                            
                            async def implement_cookie_compliance_fix(self, project: Project, issue: ComplianceIssue):
                                """Generate cookie banner and consent management"""
                                
                                # Analyze cookies and third-party scripts
                                cookie_analysis = await self.analyze_cookies_and_scripts(project.website_url)
                                
                                # Use Claude for complex HTML/JS generation
                                prompt = f"""
                                Erstelle eine vollständige Cookie-Compliance-Lösung für:
                        
                                Website: {project.website_url}
                                Gefundene Cookies/Scripts: {json.dumps(cookie_analysis, indent=2)}
                        
                                TTDSG/DSGVO-ANFORDERUNGEN:
                                - Opt-In vor nicht-essentiellen Cookies (TTDSG §25)
                                - Kategorisierung: Essenziell, Analytik, Marketing, Funktional
                                - Granulare Einwilligung pro Kategorie
                                - Einfacher Widerruf der Einwilligung
                                - Cookie-Informationen und Zwecke
                                - Speicherdauer der Einwilligung
                        
                                TECHNISCHE UMSETZUNG:
                                1. Cookie-Banner (HTML/CSS/JS)
                                2. Consent Management Funktionen
                                3. Cookie-Kategorien-Management
                                4. Integration für Google Analytics, Facebook Pixel, etc.
                                5. Einstellungen-Modal für nachträgliche Änderungen
                        
                                Erstelle vollständigen HTML/CSS/JavaScript Code für:
                                - Responsive Cookie-Banner
                                - Consent Management System
                                - Cookie-Einstellungen Modal
                                - Integration Script für beliebte Tools
                        
                                Verwende modernes JavaScript (ES6+) und responsive CSS.
                                """
                                
                                response = await self.claude_client.messages.create(
                                    model="claude-3-5-sonnet-20241022",
                                    max_tokens=4000,
                                    messages=[
                                        {
                                            "role": "user",
                                            "content": prompt
                                        }
                                    ]
                                )
                                
                                cookie_code = response.content[0].text
                                
                                return {
                                    "fix_type": "cookie_compliance_system",
                                    "generated_content": cookie_code,
                                    "implementation_method": "html_js_injection",
                                    "target_location": "before_closing_body_tag",
                                    "required_files": ["cookie-banner.css", "consent-manager.js"],
                                    "instructions": "Cookie-Banner-Code vor </body> Tag einfügen, CSS in <head> einbinden",
                                    "compliance_notes": "TTDSG §25 konform, granulare Einwilligung, DSGVO-konforme Speicherung"
                                }
                            
                            async def fix_accessibility_issues(self, project: Project, issue: ComplianceIssue):
                                """Fix accessibility issues using WCAG 2.1 AA standards"""
                                
                                # Analyze website accessibility
                                accessibility_audit = await self.perform_accessibility_audit(project.website_url)
                                
                                prompt = f"""
                                Erstelle Accessibility-Fixes nach WCAG 2.1 AA und BITV 2.0 für:
                        
                                Website: {project.website_url}
                                Gefundene Accessibility-Issues: {json.dumps(accessibility_audit, indent=2)}
                        
                                WCAG 2.1 AA ANFORDERUNGEN:
                                - Alt-Texte für alle Bilder
                                - Farbkontrast min. 4.5:1 (normal) / 3:1 (groß)
                                - Keyboard-Navigation für alle interaktiven Elemente
                                - Fokus-Indikatoren sichtbar
                                - Semantische HTML-Struktur (h1-h6)
                                - ARIA-Labels für komplexe UI-Elemente
                                - Formulare mit Labels/Legends
                                - Skip-Links für Navigation
                        
                                BITV 2.0 DEUTSCHE ANFORDERUNGEN:
                                - Deutsche Barrierefreiheitserklärung
                                - Feedback-Mechanismus
                                - Leichte Sprache (optional)
                                - Gebärdensprache-Videos (falls erforderlich)
                        
                                Erstelle konkreten HTML/CSS/JavaScript Code für:
                                1. Missing Alt-Text fixes
                                2. Color contrast improvements
                                3. Keyboard navigation enhancements
                                4. ARIA labels and roles
                                5. Form accessibility improvements
                                6. Focus management
                                7. Screen reader optimizations
                        
                                Gib nur den implementierbaren Code zurück, strukturiert nach Fix-Kategorien.
                                """
                                
                                response = await self.claude_client.messages.create(
                                    model="claude-3-5-sonnet-20241022",
                                    max_tokens=3000,
                                    messages=[
                                        {
                                            "role": "user", 
                                            "content": prompt
                                        }
                                    ]
                                )
                                
                                accessibility_fixes = response.content[0].text
                                
                                return {
                                    "fix_type": "accessibility_improvements",
                                    "generated_content": accessibility_fixes,
                                    "implementation_method": "css_js_html_patches",
                                    "target_areas": ["images", "forms", "navigation", "interactive_elements"],
                                    "instructions": "Accessibility-Fixes schrittweise implementieren, Alt-Texte manuell prüfen",
                                    "compliance_notes": "WCAG 2.1 AA konform, BITV 2.0 berücksichtigt, Screen-Reader optimiert"
                                }
                            
                            async def generate_generic_fix(self, project: Project, issue: ComplianceIssue):
                                """Generate generic compliance fix for other issues"""
                                
                                prompt = f"""
                                Erstelle eine Lösung für folgendes Compliance-Problem:
                        
                                Website: {project.website_url}
                                Problem-Kategorie: {issue.category}
                                Problem-Beschreibung: {issue.description}
                                Schweregrad: {issue.severity}
                        
                                Analysiere das Problem und erstelle eine konkrete, implementierbare Lösung.
                                Berücksichtige dabei deutsches Recht und aktuelle Best Practices.
                        
                                Format der Antwort:
                                1. Problem-Analyse
                                2. Rechtliche Grundlage
                                3. Konkrete Lösung (HTML/CSS/JS falls nötig)
                                4. Implementierungsanweisungen
                                5. Compliance-Hinweise
                                """
                                
                                response = await self.openai_client.chat.completions.create(
                                    model="gpt-4-turbo",
                                    messages=[
                                        {"role": "system", "content": "Du bist ein Compliance-Experte für deutsches Internetrecht."},
                                        {"role": "user", "content": prompt}
                                    ],
                                    temperature=0.2,
                                    max_tokens=1500
                                )
                                
                                generic_fix = response.choices[0].message.content
                                
                                return {
                                    "fix_type": "generic_compliance_fix",
                                    "generated_content": generic_fix,
                                    "implementation_method": "manual_review_recommended",
                                    "instructions": "Lösung prüfen und manuell implementieren",
                                    "compliance_notes": "Experten-Review empfohlen"
                                }
                            
                            # === WEBSITE ANALYSIS HELPERS ===
                            
                            async def extract_website_info(self, url: str) -> dict:
                                """Extract business information from website"""
                                
                                async with aiohttp.ClientSession() as session:
                                    try:
                                        async with session.get(url, timeout=10) as response:
                                            html = await response.text()
                                            
                                        # Use GPT-4 to extract structured business information
                                        prompt = f"""
                                        Analysiere diese Website und extrahiere Geschäftsinformationen:
                        
                                        URL: {url}
                                        HTML-Inhalt: {html[:3000]}...
                        
                                        Extrahiere folgende Informationen (falls vorhanden):
                                        - Firmenname/Name des Anbieters
                                        - Anschrift (Straße, PLZ, Ort)
                                        - Kontakt (Telefon, E-Mail)
                                        - Geschäftsführer/Inhaber
                                        - Rechtsform
                                        - Umsatzsteuer-ID
                                        - Handelsregister-Nummer
                                        - Branche/Geschäftstätigkeit
                        
                                        Gib das Ergebnis als JSON zurück. Nur gefundene Informationen einbeziehen.
                                        """
                                        
                                        response = await self.openai_client.chat.completions.create(
                                            model="gpt-4-turbo",
                                            messages=[{"role": "user", "content": prompt}],
                                            temperature=0.1,
                                            max_tokens=1000
                                        )
                                        
                                        try:
                                            return json.loads(response.choices[0].message.content)
                                        except:
                                            return {"error": "Could not parse business information"}
                                            
                                    except Exception as e:
                                        logger.error(f"Error extracting website info: {str(e)}")
                                        return {"error": str(e)}
                            
                            async def analyze_data_processing(self, url: str) -> dict:
                                """Analyze website for GDPR-relevant data processing"""
                                
                                async with aiohttp.ClientSession() as session:
                                    try:
                                        async with session.get(url, timeout=10) as response:
                                            html = await response.text()
                                        
                                        # Check for common tracking/analytics tools
                                        tracking_analysis = {
                                            "google_analytics": "gtag(" in html or "ga(" in html,
                                            "google_tag_manager": "googletagmanager" in html,
                                            "facebook_pixel": "fbq(" in html,
                                            "contact_forms": "<form" in html and ("email" in html.lower() or "mail" in html.lower()),
                                            "newsletter_signup": "newsletter" in html.lower() or "anmeld" in html.lower(),
                                            "social_media_plugins": any(social in html for social in ["facebook.com", "twitter.com", "instagram.com"]),
                                            "cookies_detected": "document.cookie" in html or "localStorage" in html,
                                            "third_party_scripts": self.count_external_scripts(html)
                                        }
                                        
                                        return tracking_analysis
                                        
                                    except Exception as e:
                                        logger.error(f"Error analyzing data processing: {str(e)}")
                                        return {"error": str(e)}
                            
                            async def analyze_cookies_and_scripts(self, url: str) -> dict:
                                """Analyze cookies and third-party scripts"""
                                
                                async with aiohttp.ClientSession() as session:
                                    try:
                                        async with session.get(url, timeout=10) as response:
                                            html = await response.text()
                                            headers = response.headers
                                        
                                        # Analyze cookies from Set-Cookie headers
                                        cookies_found = []
                                        if 'Set-Cookie' in headers:
                                            cookies_found = headers.getall('Set-Cookie')
                                        
                                        # Analyze third-party scripts
                                        external_scripts = self.extract_external_scripts(html)
                                        
                                        # Categorize tracking tools
                                        tracking_tools = {
                                            "analytics": self.detect_analytics_tools(html),
                                            "advertising": self.detect_advertising_tools(html),
                                            "social_media": self.detect_social_tools(html),
                                            "functionality": self.detect_functionality_tools(html)
                                        }
                                        
                                        return {
                                            "cookies_found": len(cookies_found),
                                            "cookie_details": cookies_found[:5],  # First 5 cookies
                                            "external_scripts": external_scripts,
                                            "tracking_tools": tracking_tools,
                                            "compliance_required": len(external_scripts) > 0 or len(cookies_found) > 0
                                        }
                                        
                                    except Exception as e:
                                        logger.error(f"Error analyzing cookies: {str(e)}")
                                        return {"error": str(e)}
                            
                            async def perform_accessibility_audit(self, url: str) -> dict:
                                """Perform basic accessibility audit"""
                                
                                async with aiohttp.ClientSession() as session:
                                    try:
                                        async with session.get(url, timeout=10) as response:
                                            html = await response.text()
                                        
                                        from bs4 import BeautifulSoup
                                        soup = BeautifulSoup(html, 'html.parser')
                                        
                                        audit_results = {
                                            "images_without_alt": len(soup.find_all('img', alt=False)),
                                            "missing_headings": len(soup.find_all(['h1', 'h2', 'h3', 'h4', 'h5', 'h6'])) == 0,
                                            "forms_without_labels": self.count_unlabeled_forms(soup),
                                            "missing_lang_attribute": not soup.html.get('lang') if soup.html else True,
                                            "links_without_text": len([a for a in soup.find_all('a') if not a.get_text(strip=True)]),
                                            "missing_skip_links": not soup.find('a', href='#main') and not soup.find('a', href='#content'),
                                            "color_contrast_warnings": self.analyze_color_contrast(soup),
                                            "interactive_elements": len(soup.find_all(['button', 'input', 'select', 'textarea', 'a']))
                                        }
                                        
                                        return audit_results
                                        
                                    except Exception as e:
                                        logger.error(f"Error performing accessibility audit: {str(e)}")
                                        return {"error": str(e)}
                            
                            # === HELPER METHODS ===
                            
                            def count_external_scripts(self, html: str) -> int:
                                """Count external script tags"""
                                from bs4 import BeautifulSoup
                                soup = BeautifulSoup(html, 'html.parser')
                                
                                external_scripts = 0
                                for script in soup.find_all('script', src=True):
                                    src = script.get('src')
                                    if src and (src.startswith('http') or src.startswith('//')):
                                        external_scripts += 1
                                        
                                return external_scripts
                            
                            def extract_external_scripts(self, html: str) -> list:
                                """Extract list of external script URLs"""
                                from bs4 import BeautifulSoup
                                soup = BeautifulSoup(html, 'html.parser')
                                
                                scripts = []
                                for script in soup.find_all('script', src=True):
                                    src = script.get('src')
                                    if src and (src.startswith('http') or src.startswith('//')):
                                        scripts.append(src)
                                        
                                return scripts[:10]  # Return first 10
                            
                            def detect_analytics_tools(self, html: str) -> list:
                                """Detect analytics tracking tools"""
                                tools = []
                                analytics_patterns = {
                                    'Google Analytics': ['gtag(', 'ga(', 'google-analytics'],
                                    'Google Tag Manager': ['googletagmanager'],
                                    'Matomo': ['matomo', '_paq'],
                                    'Adobe Analytics': ['s_code', 'adobe.com/analytics']
                                }
                                
                                for tool, patterns in analytics_patterns.items():
                                    if any(pattern in html for pattern in patterns):
                                        tools.append(tool)
                                        
                                return tools
                            
                            def detect_advertising_tools(self, html: str) -> list:
                                """Detect advertising/marketing tools"""
                                tools = []
                                ad_patterns = {
                                    'Facebook Pixel': ['fbq(', 'facebook.com/tr'],
                                    'Google Ads': ['googleadservices', 'googlesyndication'],
                                    'LinkedIn Insight': ['linkedin.com/li.lms'],
                                    'Twitter Ads': ['ads-twitter.com']
                                }
                                
                                for tool, patterns in ad_patterns.items():
                                    if any(pattern in html for pattern in patterns):
                                        tools.append(tool)
                                        
                                return tools
                            
                            def detect_social_tools(self, html: str) -> list:
                                """Detect social media tools"""
                                tools = []
                                social_patterns = {
                                    'Facebook SDK': ['facebook.com/sdk'],
                                    'Twitter Widgets': ['twitter.com/widgets'],
                                    'YouTube Embed': ['youtube.com/embed'],
                                    'Instagram Embed': ['instagram.com/embed']
                                }
                                
                                for tool, patterns in social_patterns.items():
                                    if any(pattern in html for pattern in patterns):
                                        tools.append(tool)
                                        
                                return tools
                            
                            def detect_functionality_tools(self, html: str) -> list:
                                """Detect functionality tools"""
                                tools = []
                                func_patterns = {
                                    'Google Maps': ['maps.googleapis.com', 'maps.google.com'],
                                    'reCAPTCHA': ['recaptcha', 'google.com/recaptcha'],
                                    'Font Services': ['fonts.googleapis.com', 'typekit.net'],
                                    'CDN Services': ['cdnjs.cloudflare.com', 'jsdelivr.net']
                                }
                                
                                for tool, patterns in func_patterns.items():
                                    if any(pattern in html for pattern in patterns):
                                        tools.append(tool)
                                        
                                return tools
                            
                            def count_unlabeled_forms(self, soup) -> int:
                                """Count form inputs without proper labels"""
                                unlabeled = 0
                                
                                for input_tag in soup.find_all(['input', 'select', 'textarea']):
                                    input_id = input_tag.get('id')
                                    input_name = input_tag.get('name')
                                    
                                    # Check for associated label
                                    has_label = False
                                    if input_id:
                                        has_label = soup.find('label', {'for': input_id}) is not None
                                    
                                    # Check for aria-label
                                    has_aria_label = input_tag.get('aria-label') is not None
                                    
                                    # Check for title
                                    has_title = input_tag.get('title') is not None
                                    
                                    if not (has_label or has_aria_label or has_title):
                                        unlabeled += 1
                                        
                                return unlabeled
                            
                            def analyze_color_contrast(self, soup) -> int:
                                """Basic color contrast analysis (simplified)"""
                                # This is a simplified version - full contrast analysis requires 
                                # rendering and color extraction
                                warnings = 0
                                
                                # Check for common low-contrast patterns
                                styles = soup.find_all(style=True)
                                for element in styles:
                                    style_content = element.get('style', '').lower()
                                    if 'color:' in style_content and 'background' in style_content:
                                        # This would need proper color parsing and contrast calculation
                                        # For now, just flag potential issues
                                        if any(color in style_content for color in ['#ccc', '#ddd', '#eee', 'lightgray']):
                                            warnings += 1
                                            
                                return warnings
                            
                            async def trigger_post_fix_rescan(self, project_id: str):
                                """Trigger website re-scan after AI fixes are completed"""
                                logger.info(f"Triggering post-fix re-scan for project {project_id}")
                                
                                db = self.session_local()
                                try:
                                    project = db.query(Project).filter(Project.id == project_id).first()
                                    if not project:
                                        return
                                    
                                    # Perform new compliance scan
                                    from compliance_engine import ComplianceEngine
                                    compliance_engine = ComplianceEngine()
                                    
                                    new_analysis_data = await compliance_engine.analyze_website(project.website_url)
                                    
                                    # Save new analysis
                                    new_analysis = Analysis(
                                        project_id=project.id,
                                        analysis_data=new_analysis_data,
                                        overall_score=new_analysis_data.get('overall_score', 0),
                                        total_issues=new_analysis_data.get('total_issues', 0),
                                        analysis_type='post_ai_fix'
                                    )
                                    db.add(new_analysis)
                                    
                                    # Update project
                                    project.current_score = new_analysis_data.get('overall_score', 0)
                                    
                                    # Check if target score reached
                                    if project.current_score >= project.target_score:
                                        project.status = 'completed'
                                    else:
                                        project.status = 'monitoring'
                                    
                                    db.commit()
                                    
                                    # Send completion notification
                                    await self.send_ai_completion_notification(project)
                                    
                                    logger.info(f"Post-fix re-scan completed. New score: {project.current_score}")
                                    
                                except Exception as e:
                                    logger.error(f"Error in post-fix re-scan: {str(e)}")
                                finally:
                                    db.close()
                            
                            async def send_ai_completion_notification(self, project: Project):
                                """Send notification when AI fixes are completed"""
                                from email_service import send_ai_completion_email
                                
                                try:
                                    await send_ai_completion_email(
                                        user_email=project.user.email,
                                        project_name=project.project_name,
                                        old_score=0,  # Would need to track previous score
                                        new_score=project.current_score,
                                        project_url=f"https://app.complyo.tech/dashboard?project={project.id}"
                                    )
                                except Exception as e:
                                    logger.error(f"Error sending AI completion notification: {str(e)}")
                        
                        # === EXPERT SERVICE INTEGRATION ===
                        class ExpertService:
                            def __init__(self):
                                self.session_local = SessionLocal
                                
                            async def schedule_initial_consultation(self, project_id: str, user_email: str):
                                """Schedule initial expert consultation"""
                                
                                # Generate Calendly link with project context
                                calendly_link = self.generate_calendly_link(user_email, project_id)
                                
                                # Send welcome email with booking link
                                from email_service import send_expert_welcome_email
                                await send_expert_welcome_email(user_email, project_id, calendly_link)
                                
                                return calendly_link
                            
                            def generate_calendly_link(self, user_email: str, project_id: str) -> str:
                                """Generate Calendly booking link"""
                                import urllib.parse
                                
                                base_url = "https://calendly.com/complyo-experts/initial-consultation"
                                params = {
                                    'a1': user_email,
                                    'a2': project_id,
                                    'name': 'Compliance Expert Consultation'
                                }
                                
                                return f"{base_url}?{urllib.parse.urlencode(params)}"
                            
                            async def handle_calendly_webhook(self, event_data: dict):
                                """Handle Calendly webhook for scheduled appointments"""
                                
                                # Extract project context from event
                                project_id = event_data.get('questions_and_answers', {}).get('a2')
                                
                                if project_id:
                                    db = self.session_local()
                                    try:
                                        # Update project status
                                        project = db.query(Project).filter(Project.id == project_id).first()
                                        if project:
                                            project.status = 'expert_scheduled'
                                            db.commit()
                                            
                                        # Create appointment record
                                        from models import ExpertAppointment
                                        appointment = ExpertAppointment(
                                            project_id=project_id,
                                            calendly_event_id=event_data['uri'],
                                            appointment_datetime=event_data['start_time'],
                                            expert_email=event_data.get('assigned_to', 'expert@complyo.tech'),
                                            status='scheduled'
                                        )
                                        db.add(appointment)
                                        db.commit()
                                        
                                    finally:
                                        db.close()
                        
                        # === MONITORING & MAINTENANCE ===
                        async def daily_monitoring_scan():
                            """Daily monitoring scan for all active projects"""
                            logger.info("Starting daily monitoring scan")
                            
                            db = SessionLocal()
                            try:
                                # Get all projects in monitoring status
                                monitoring_projects = db.query(Project).filter(
                                    Project.status.in_(['monitoring', 'completed'])
                                ).all()
                                
                                logger.info(f"Found {len(monitoring_projects)} projects for monitoring")
                                
                                ai_engine = AIComplianceEngine()
                                
                                for project in monitoring_projects:
                                    try:
                                        # Re-scan website
                                        from compliance_engine import ComplianceEngine
                                        compliance_engine = ComplianceEngine()
                                        
                                        new_analysis_data = await compliance_engine.analyze_website(project.website_url)
                                        
                                        # Compare with previous analysis
                                        previous_analysis = db.query(Analysis).filter(
                                            Analysis.project_id == project.id
                                        ).order_by(Analysis.scan_timestamp.desc()).first()
                                        
                                        score_change = new_analysis_data.get('overall_score', 0) - (previous_analysis.overall_score if previous_analysis else 0)
                                        
                                        # Save new analysis
                                        new_analysis = Analysis(
                                            project_id=project.id,
                                            analysis_data=new_analysis_data,
                                            overall_score=new_analysis_data.get('overall_score', 0),
                                            total_issues=new_analysis_data.get('total_issues', 0),
                                            analysis_type='monitoring'
                                        )
                                        db.add(new_analysis)
                                        
                                        # Update project score
                                        project.current_score = new_analysis_data.get('overall_score', 0)
                                        
                                        # Alert if significant score drop
                                        if score_change < -10:
                                            await send_compliance_alert(project, score_change)
                                            
                                            # If AI plan, trigger automatic fixes
                                            if project.user.plan_type == 'ai':
                                                await ai_engine.process_project_fixes(str(project.id))
                                        
                                        db.commit()
                                        
                                    except Exception as e:
                                        logger.error(f"Error monitoring project {project.id}: {str(e)}")
                                        
                            except Exception as e:
                                logger.error(f"Error in daily monitoring: {str(e)}")
                            finally:
                                db.close()
                        
                        async def send_compliance_alert(project: Project, score_change: int):
                            """Send alert when compliance score drops significantly"""
                            from email_service import send_compliance_alert_email
                            
                            await send_compliance_alert_email(
                                user_email=project.user.email,
                                project_name=project.project_name,
                                score_change=score_change,
                                current_score=project.current_score,
                                project_url=f"https://app.complyo.tech/dashboard?project={project.id}"
                            )
                        
                        # === CELERY TASKS FOR BACKGROUND PROCESSING ===
                        from celery import Celery
                        
                        celery_app = Celery('complyo_ai')
                        
                        @celery_app.task
                        async def process_ai_fixes_task(project_id: str):
                            """Celery task for AI fix processing"""
                            ai_engine = AIComplianceEngine()
                            await ai_engine.process_project_fixes(project_id)
                        
                        @celery_app.task
                        async def daily_monitoring_task():
                            """Celery task for daily monitoring"""
                            await daily_monitoring_scan()
                        
                        # Scheduler configuration
                        from celery.schedules import crontab
                        
                        celery_app.conf.beat_schedule = {
                            'daily-monitoring': {
                                'task': 'ai_automation.daily_monitoring_task',
                                'schedule': crontab(hour=2, minute=0),  # 2 AM daily
                            },
                        }
                        
                        if __name__ == "__main__":
                            # Test the AI engine
                            import asyncio
                            
                            async def test_ai_engine():
                                ai_engine = AIComplianceEngine()
                                # Test with a sample project
                                # await ai_engine.start_project_automation("test-project-id")
                                print("AI Engine initialized successfully")
                            
                            asyncio.run(test_ai_engine())
































                            // COMPLYO DASHBOARD FRONTEND
                            // /opt/projects/saas-project-2/legal/dashboard/
                            
                            // === DASHBOARD MAIN PAGE ===
                            // pages/dashboard.tsx
                            import React, { useState, useEffect } from 'react';
                            import { useRouter } from 'next/router';
                            import Link from 'next/link';
                            import { format } from 'date-fns';
                            import { de } from 'date-fns/locale';
                            
                            interface User {
                              email: string;
                              plan_type: 'ai' | 'expert';
                              subscription_status: string;
                            }
                            
                            interface Project {
                              id: string;
                              website_url: string;
                              project_name: string;
                              status: string;
                              current_score: number;
                              target_score: number;
                              progress_percentage: number;
                              open_issues: number;
                              total_issues: number;
                              last_scan: string;
                              created_at: string;
                            }
                            
                            interface DashboardData {
                              user: User;
                              projects: Project[];
                            }
                            
                            const Dashboard: React.FC = () => {
                              const [dashboardData, setDashboardData] = useState<DashboardData | null>(null);
                              const [loading, setLoading] = useState(true);
                              const [error, setError] = useState<string | null>(null);
                              const router = useRouter();
                            
                              useEffect(() => {
                                fetchDashboardData();
                              }, []);
                            
                              const fetchDashboardData = async () => {
                                try {
                                  const token = localStorage.getItem('complyo_auth_token');
                                  if (!token) {
                                    router.push('/login');
                                    return;
                                  }
                            
                                  const response = await fetch('https://api.complyo.tech/api/dashboard/overview', {
                                    headers: {
                                      'Authorization': `Bearer ${token}`,
                                      'Content-Type': 'application/json'
                                    }
                                  });
                            
                                  if (!response.ok) {
                                    throw new Error('Failed to fetch dashboard data');
                                  }
                            
                                  const data = await response.json();
                                  setDashboardData(data);
                                } catch (err) {
                                  setError(err instanceof Error ? err.message : 'Unknown error');
                                } finally {
                                  setLoading(false);
                                }
                              };
                            
                              const getStatusColor = (status: string) => {
                                const statusColors = {
                                  'analyzing': 'bg-yellow-500',
                                  'fixing': 'bg-blue-500',
                                  'ai_analyzing': 'bg-purple-500',
                                  'completed': 'bg-green-500',
                                  'monitoring': 'bg-gray-500',
                                  'expert_scheduled': 'bg-orange-500'
                                };
                                return statusColors[status as keyof typeof statusColors] || 'bg-gray-500';
                              };
                            
                              const getStatusText = (status: string) => {
                                const statusTexts = {
                                  'analyzing': 'Analysiert',
                                  'fixing': 'Wird behoben',
                                  'ai_analyzing': 'KI arbeitet',
                                  'completed': 'Abgeschlossen',
                                  'monitoring': 'Überwacht',
                                  'expert_scheduled': 'Experten-Termin geplant'
                                };
                                return statusTexts[status as keyof typeof statusTexts] || status;
                              };
                            
                              const getScoreColor = (score: number) => {
                                if (score >= 90) return 'text-green-400';
                                if (score >= 70) return 'text-yellow-400';
                                return 'text-red-400';
                              };
                            
                              if (loading) {
                                return (
                                  <div className="min-h-screen bg-complyo-dark flex items-center justify-center">
                                    <div className="animate-spin w-12 h-12 border-4 border-complyo-primary border-t-transparent rounded-full"></div>
                                  </div>
                                );
                              }
                            
                              if (error) {
                                return (
                                  <div className="min-h-screen bg-complyo-dark flex items-center justify-center">
                                    <div className="text-center">
                                      <h1 className="text-2xl font-bold text-red-400 mb-4">Fehler</h1>
                                      <p className="text-gray-300 mb-4">{error}</p>
                                      <button 
                                        onClick={fetchDashboardData}
                                        className="bg-complyo-primary hover:bg-complyo-primary/80 px-4 py-2 rounded-lg transition-colors"
                                      >
                                        Erneut versuchen
                                      </button>
                                    </div>
                                  </div>
                                );
                              }
                            
                              return (
                                <div className="min-h-screen bg-complyo-dark text-white">
                                  {/* Header */}
                                  <header className="bg-complyo-gray border-b border-complyo-primary/20">
                                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                      <div className="flex justify-between items-center h-16">
                                        <div className="flex items-center">
                                          <h1 className="text-2xl font-bold bg-gradient-to-r from-complyo-primary to-complyo-accent bg-clip-text text-transparent">
                                            Complyo
                                          </h1>
                                          <span className="ml-4 px-3 py-1 bg-complyo-primary/20 text-complyo-primary rounded-full text-sm font-medium">
                                            {dashboardData?.user.plan_type === 'ai' ? 'KI-Plan' : 'Experten-Plan'}
                                          </span>
                                        </div>
                                        <div className="flex items-center space-x-4">
                                          <span className="text-gray-300">{dashboardData?.user.email}</span>
                                          <button 
                                            onClick={() => {
                                              localStorage.removeItem('complyo_auth_token');
                                              router.push('/');
                                            }}
                                            className="text-gray-400 hover:text-white transition-colors"
                                          >
                                            Abmelden
                                          </button>
                                        </div>
                                      </div>
                                    </div>
                                  </header>
                            
                                  {/* Main Content */}
                                  <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                                    {/* Welcome Section {/* Welcome Section */}
                                    <div className="mb-8">
                                      <h1 className="text-3xl font-bold mb-2">
                                        Willkommen zurück!
                                      </h1>
                                      <p className="text-gray-300">
                                        Übersicht Ihrer Compliance-Projekte und aktueller Status
                                      </p>
                                    </div>
                            
                                    {/* Stats Overview */}
                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                                      <div className="bg-complyo-gray/50 rounded-xl p-6 border border-complyo-primary/20">
                                        <div className="flex items-center justify-between">
                                          <div>
                                            <p className="text-gray-400 text-sm">Projekte gesamt</p>
                                            <p className="text-2xl font-bold text-white">
                                              {dashboardData?.projects.length || 0}
                                            </p>
                                          </div>
                                          <div className="bg-complyo-primary/20 p-3 rounded-lg">
                                            <svg className="w-6 h-6 text-complyo-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 8h1m-1-4h1m4 4h1m-1-4h1" />
                                            </svg>
                                          </div>
                                        </div>
                                      </div>
                            
                                      <div className="bg-complyo-gray/50 rounded-xl p-6 border border-complyo-accent/20">
                                        <div className="flex items-center justify-between">
                                          <div>
                                            <p className="text-gray-400 text-sm">Durchschnittsscore</p>
                                            <p className="text-2xl font-bold text-complyo-accent">
                                              {dashboardData?.projects.length ? 
                                                Math.round(dashboardData.projects.reduce((acc, p) => acc + p.current_score, 0) / dashboardData.projects.length) 
                                                : 0}
                                            </p>
                                          </div>
                                          <div className="bg-complyo-accent/20 p-3 rounded-lg">
                                            <svg className="w-6 h-6 text-complyo-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                            </svg>
                                          </div>
                                        </div>
                                      </div>
                            
                                      <div className="bg-complyo-gray/50 rounded-xl p-6 border border-green-500/20">
                                        <div className="flex items-center justify-between">
                                          <div>
                                            <p className="text-gray-400 text-sm">Abgeschlossen</p>
                                            <p className="text-2xl font-bold text-green-400">
                                              {dashboardData?.projects.filter(p => p.status === 'completed').length || 0}
                                            </p>
                                          </div>
                                          <div className="bg-green-500/20 p-3 rounded-lg">
                                            <svg className="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                                            </svg>
                                          </div>
                                        </div>
                                      </div>
                            
                                      <div className="bg-complyo-gray/50 rounded-xl p-6 border border-yellow-500/20">
                                        <div className="flex items-center justify-between">
                                          <div>
                                            <p className="text-gray-400 text-sm">Offene Issues</p>
                                            <p className="text-2xl font-bold text-yellow-400">
                                              {dashboardData?.projects.reduce((acc, p) => acc + p.open_issues, 0) || 0}
                                            </p>
                                          </div>
                                          <div className="bg-yellow-500/20 p-3 rounded-lg">
                                            <svg className="w-6 h-6 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.732 15.5c-.77.833.192 2.5 1.732 2.5z" />
                                            </svg>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                            
                                    {/* Projects List */}
                                    <div className="space-y-6">
                                      <div className="flex justify-between items-center">
                                        <h2 className="text-xl font-bold">Ihre Projekte</h2>
                                        <button 
                                          onClick={() => router.push('/scan')}
                                          className="bg-complyo-primary hover:bg-complyo-primary/80 px-4 py-2 rounded-lg transition-colors"
                                        >
                                          + Neue Website hinzufügen
                                        </button>
                                      </div>
                            
                                      {dashboardData?.projects.length === 0 ? (
                                        <div className="bg-complyo-gray/50 rounded-xl p-8 text-center border border-complyo-primary/20">
                                          <svg className="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 8h1m-1-4h1m4 4h1m-1-4h1" />
                                          </svg>
                                          <h3 className="text-lg font-medium text-gray-300 mb-2">Noch keine Projekte</h3>
                                          <p className="text-gray-400 mb-4">Starten Sie mit der Analyse Ihrer ersten Website</p>
                                          <button 
                                            onClick={() => router.push('/scan')}
                                            className="bg-complyo-primary hover:bg-complyo-primary/80 px-6 py-3 rounded-lg transition-colors"
                                          >
                                            Erste Website analysieren
                                          </button>
                                        </div>
                                      ) : (
                                        <div className="grid gap-6">
                                          {dashboardData?.projects.map((project) => (
                                            <div key={project.id} className="bg-complyo-gray/50 rounded-xl p-6 border border-complyo-primary/20 hover:border-complyo-primary/40 transition-all">
                                              <div className="flex items-start justify-between mb-4">
                                                <div className="flex-1">
                                                  <div className="flex items-center space-x-3 mb-2">
                                                    <h3 className="text-lg font-semibold text-white">
                                                      {project.project_name}
                                                    </h3>
                                                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(project.status)} text-white`}>
                                                      {getStatusText(project.status)}
                                                    </span>
                                                  </div>
                                                  <p className="text-gray-400 text-sm mb-3">{project.website_url}</p>
                                                  <div className="flex items-center space-x-6">
                                                    <div>
                                                      <p className="text-xs text-gray-400">Compliance-Score</p>
                                                      <p className={`text-2xl font-bold ${getScoreColor(project.current_score)}`}>
                                                        {project.current_score}/100
                                                      </p>
                                                    </div>
                                                    <div>
                                                      <p className="text-xs text-gray-400">Fortschritt</p>
                                                      <p className="text-sm font-medium text-white">
                                                        {project.progress_percentage}%
                                                      </p>
                                                    </div>
                                                    <div>
                                                      <p className="text-xs text-gray-400">Offene Issues</p>
                                                      <p className="text-sm font-medium text-yellow-400">
                                                        {project.open_issues}/{project.total_issues}
                                                      </p>
                                                    </div>
                                                  </div>
                                                </div>
                                                <div className="flex space-x-2">
                                                  <Link href={`/project/${project.id}`}>
                                                    <button className="bg-complyo-primary hover:bg-complyo-primary/80 px-4 py-2 rounded-lg text-sm transition-colors">
                                                      Details
                                                    </button>
                                                  </Link>
                                                </div>
                                              </div>
                            
                                              {/* Progress Bar */}
                                              <div className="mb-4">
                                                <div className="flex justify-between items-center mb-2">
                                                  <span className="text-xs text-gray-400">Compliance-Fortschritt</span>
                                                  <span className="text-xs text-gray-400">{project.progress_percentage}%</span>
                                                </div>
                                                <div className="w-full bg-complyo-dark rounded-full h-2">
                                                  <div 
                                                    className="bg-gradient-to-r from-complyo-primary to-complyo-accent h-2 rounded-full transition-all duration-300"
                                                    style={{ width: `${project.progress_percentage}%` }}
                                                  ></div>
                                                </div>
                                              </div>
                            
                                              {/* Quick Actions based on status and plan */}
                                              <div className="flex space-x-2">
                                                {project.status === 'analyzing' && (
                                                  <span className="text-xs text-gray-400 bg-complyo-dark px-3 py-1 rounded-full">
                                                    <i className="animate-spin w-3 h-3 border border-complyo-primary border-t-transparent rounded-full inline-block mr-2"></i>
                                                    Analyse läuft...
                                                  </span>
                                                )}
                                                
                                                {project.status === 'fixing' && dashboardData.user.plan_type === 'ai' && (
                                                  <Link href={`/project/${project.id}/ai-progress`}>
                                                    <button className="text-xs bg-complyo-secondary hover:bg-complyo-secondary/80 px-3 py-1 rounded-full transition-colors">
                                                      KI-Fortschritt anzeigen
                                                    </button>
                                                  </Link>
                                                )}
                                                
                                                {project.status === 'expert_scheduled' && (
                                                  <span className="text-xs text-orange-400 bg-orange-500/20 px-3 py-1 rounded-full">
                                                    Experten-Termin geplant
                                                  </span>
                                                )}
                                                
                                                {project.status === 'completed' && (
                                                  <span className="text-xs text-green-400 bg-green-500/20 px-3 py-1 rounded-full">
                                                    ✓ Rechtssicher
                                                  </span>
                                                )}
                                                
                                                {project.open_issues > 0 && project.status !== 'fixing' && (
                                                  <button 
                                                    onClick={() => startFixes(project.id)}
                                                    className="text-xs bg-complyo-primary hover:bg-complyo-primary/80 px-3 py-1 rounded-full transition-colors"
                                                  >
                                                    {dashboardData.user.plan_type === 'ai' ? 'KI-Fixes starten' : 'Experten kontaktieren'}
                                                  </button>
                                                )}
                                              </div>
                            
                                              {/* Last Scan Info */}
                                              {project.last_scan && (
                                                <div className="mt-3 pt-3 border-t border-complyo-primary/10">
                                                  <p className="text-xs text-gray-400">
                                                    Letzter Scan: {format(new Date(project.last_scan), 'dd.MM.yyyy HH:mm', { locale: de })}
                                                  </p>
                                                </div>
                                              )}
                                            </div>
                                          ))}
                                        </div>
                                      )}
                                    </div>
                            
                                    {/* Quick Actions */}
                                    <div className="mt-12 grid grid-cols-1 md:grid-cols-3 gap-6">
                                      <div className="bg-complyo-gray/50 rounded-xl p-6 border border-complyo-primary/20 text-center">
                                        <div className="bg-complyo-primary/20 w-12 h-12 rounded-lg flex items-center justify-center mx-auto mb-4">
                                          <svg className="w-6 h-6 text-complyo-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4" />
                                          </svg>
                                        </div>
                                        <h3 className="font-semibold mb-2">Neue Analyse</h3>
                                        <p className="text-gray-400 text-sm mb-4">Website-Compliance prüfen</p>
                                        <button 
                                          onClick={() => router.push('/scan')}
                                          className="bg-complyo-primary hover:bg-complyo-primary/80 px-4 py-2 rounded-lg text-sm transition-colors"
                                        >
                                          Jetzt scannen
                                        </button>
                                      </div>
                            
                                      <div className="bg-complyo-gray/50 rounded-xl p-6 border border-complyo-accent/20 text-center">
                                        <div className="bg-complyo-accent/20 w-12 h-12 rounded-lg flex items-center justify-center mx-auto mb-4">
                                          <svg className="w-6 h-6 text-complyo-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                          </svg>
                                        </div>
                                        <h3 className="font-semibold mb-2">Compliance-Report</h3>
                                        <p className="text-gray-400 text-sm mb-4">Detaillierte Berichte herunterladen</p>
                                        <button className="bg-complyo-accent hover:bg-complyo-accent/80 px-4 py-2 rounded-lg text-sm transition-colors">
                                          Report erstellen
                                        </button>
                                      </div>
                            
                                      <div className="bg-complyo-gray/50 rounded-xl p-6 border border-complyo-secondary/20 text-center">
                                        <div className="bg-complyo-secondary/20 w-12 h-12 rounded-lg flex items-center justify-center mx-auto mb-4">
                                          <svg className="w-6 h-6 text-complyo-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192L5.636 18.364M12 12h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                          </svg>
                                        </div>
                                        <h3 className="font-semibold mb-2">Support</h3>
                                        <p className="text-gray-400 text-sm mb-4">Hilfe & Experten-Beratung</p>
                                        <button className="bg-complyo-secondary hover:bg-complyo-secondary/80 px-4 py-2 rounded-lg text-sm transition-colors">
                                          Support kontaktieren
                                        </button>
                                      </div>
                                    </div>
                                  </main>
                                </div>
                              );
                            
                              // Helper function to start fixes
                              const startFixes = async (projectId: string) => {
                                try {
                                  const token = localStorage.getItem('complyo_auth_token');
                                  
                                  if (dashboardData?.user.plan_type === 'ai') {
                                    const response = await fetch(`https://api.complyo.tech/api/ai/start-fixes/${projectId}`, {
                                      method: 'POST',
                                      headers: {
                                        'Authorization': `Bearer ${token}`,
                                        'Content-Type': 'application/json'
                                      }
                                    });
                                    
                                    if (response.ok) {
                                      alert('KI-Fixes wurden gestartet! Sie erhalten eine E-Mail-Benachrichtigung nach Abschluss.');
                                      fetchDashboardData(); // Refresh data
                                    }
                                  } else {
                                    // Expert plan - redirect to scheduling
                                    router.push(`/project/${projectId}/schedule-expert`);
                                  }
                                } catch (error) {
                                  alert('Fehler beim Starten der Fixes. Bitte versuchen Sie es erneut.');
                                }
                              };
                            };
                            
                            export default Dashboard;
                            
                            // === PROJECT DETAIL PAGE ===
                            // pages/project/[id].tsx
                            import React, { useState, useEffect } from 'react';
                            import { useRouter } from 'next/router';
                            import { format } from 'date-fns';
                            import { de } from 'date-fns/locale';
                            import {
                              LineChart,
                              Line,
                              XAxis,
                              YAxis,
                              CartesianGrid,
                              Tooltip,
                              ResponsiveContainer
                            } from 'recharts';
                            
                            interface ProjectDetails {
                              project: {
                                id: string;
                                website_url: string;
                                project_name: string;
                                status: string;
                                current_score: number;
                                target_score: number;
                                created_at: string;
                              };
                              latest_analysis: {
                                id: string;
                                overall_score: number;
                                total_issues: number;
                                scan_timestamp: string;
                                analysis_data: any;
                              };
                              issues: Array<{
                                id: string;
                                category: string;
                                severity: string;
                                status: string;
                                title: string;
                                description: string;
                                ai_fix_available: boolean;
                                estimated_fix_time: number;
                                created_at: string;
                              }>;
                              active_fix_tasks: Array<{
                                id: string;
                                issue_id: string;
                                task_type: string;
                                status: string;
                                assigned_to: string;
                                created_at: string;
                              }>;
                              progress_history: Array<{
                                date: string;
                                score: number;
                                issues: number;
                              }>;
                            }
                            
                            const ProjectDetail: React.FC = () => {
                              const [projectData, setProjectData] = useState<ProjectDetails | null>(null);
                              const [loading, setLoading] = useState(true);
                              const [error, setError] = useState<string | null>(null);
                              const [activeTab, setActiveTab] = useState<'overview' | 'issues' | 'progress' | 'fixes'>('overview');
                              const router = useRouter();
                              const { id } = router.query;
                            
                              useEffect(() => {
                                if (id) {
                                  fetchProjectDetails();
                                }
                              }, [id]);
                            
                              const fetchProjectDetails = async () => {
                                try {
                                  const token = localStorage.getItem('complyo_auth_token');
                                  if (!token) {
                                    router.push('/login');
                                    return;
                                  }
                            
                                  const response = await fetch(`https://api.complyo.tech/api/project/${id}`, {
                                    headers: {
                                      'Authorization': `Bearer ${token}`,
                                      'Content-Type': 'application/json'
                                    }
                                  });
                            
                                  if (!response.ok) {
                                    throw new Error('Failed to fetch project details');
                                  }
                            
                                  const data = await response.json();
                                  setProjectData(data);
                                } catch (err) {
                                  setError(err instanceof Error ? err.message : 'Unknown error');
                                } finally {
                                  setLoading(false);
                                }
                              };
                            
                              const getSeverityColor = (severity: string) => {
                                const colors = {
                                  'critical': 'text-red-400 bg-red-500/20',
                                  'high': 'text-orange-400 bg-orange-500/20',
                                  'medium': 'text-yellow-400 bg-yellow-500/20',
                                  'low': 'text-blue-400 bg-blue-500/20'
                                };
                                return colors[severity as keyof typeof colors] || 'text-gray-400 bg-gray-500/20';
                              };
                            
                              const getCategoryIcon = (category: string) => {
                                const icons = {
                                  'impressum': '📋',
                                  'datenschutz': '🔒',
                                  'cookies': '🍪',
                                  'accessibility': '♿',
                                  'general': '⚙️'
                                };
                                return icons[category as keyof typeof icons] || '📝';
                              };
                            
                              if (loading) {
                                return (
                                  <div className="min-h-screen bg-complyo-dark flex items-center justify-center">
                                    <div className="animate-spin w-12 h-12 border-4 border-complyo-primary border-t-transparent rounded-full"></div>
                                  </div>
                                );
                              }
                            
                              if (error || !projectData) {
                                return (
                                  <div className="min-h-screen bg-complyo-dark flex items-center justify-center">
                                    <div className="text-center">
                                      <h1 className="text-2xl font-bold text-red-400 mb-4">Projekt nicht gefunden</h1>
                                      <button 
                                        onClick={() => router.push('/dashboard')}
                                        className="bg-complyo-primary hover:bg-complyo-primary/80 px-4 py-2 rounded-lg transition-colors"
                                      >
                                        Zurück zum Dashboard
                                      </button>
                                    </div>
                                  </div>
                                );
                              }
                            
                              return (
                                <div className="min-h-screen bg-complyo-dark text-white">
                                  {/* Header */}
                                  <header className="bg-complyo-gray border-b border-complyo-primary/20">
                                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                      <div className="flex justify-between items-center h-16">
                                        <div className="flex items-center">
                                          <button 
                                            onClick={() => router.push('/dashboard')}
                                            className="mr-4 text-gray-400 hover:text-white transition-colors"
                                          >
                                            ← Zurück
                                          </button>
                                          <h1 className="text-2xl font-bold bg-gradient-to-r from-complyo-primary to-complyo-accent bg-clip-text text-transparent">
                                            {projectData.project.project_name}
                                          </h1>
                                        </div>
                                        <div className="flex items-center space-x-4">
                                          <span className="text-sm text-gray-400">{projectData.project.website_url}</span>
                                        </div>
                                      </div>
                                    </div>
                                  </header>
                            
                                  {/* Project Stats */}
                                  <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                                      <div className="bg-complyo-gray/50 rounded-xl p-6 border border-complyo-primary/20">
                                        <div className="text-center">
                                          <div className="text-3xl font-bold text-complyo-primary mb-2">
                                            {projectData.latest_analysis?.overall_score || 0}
                                          </div>
                                          <div className="text-sm text-gray-400">Compliance-Score</div>
                                          <div className="w-full bg-complyo-dark rounded-full h-2 mt-3">
                                            <div 
                                              className="bg-gradient-to-r from-complyo-primary to-complyo-accent h-2 rounded-full"
                                              style={{ width: `${projectData.latest_analysis?.overall_score || 0}%` }}
                                            ></div>
                                          </div>
                                        </div>
                                      </div>
                            
                                      <div className="bg-complyo-gray/50 rounded-xl p-6 border border-yellow-500/20">
                                        <div className="text-center">
                                          <div className="text-3xl font-bold text-yellow-400 mb-2">
                                            {projectData.issues.filter(i => i.status === 'open').length}
                                          </div>
                                          <div className="text-sm text-gray-400">Offene Issues</div>
                                          <div className="text-xs text-gray-500 mt-1">
                                            von {projectData.issues.length} gesamt
                                          </div>
                                        </div>
                                      </div>
                            
                                      <div className="bg-complyo-gray/50 rounded-xl p-6 border border-green-500/20">
                                        <div className="text-center">
                                          <div className="text-3xl font-bold text-green-400 mb-2">
                                            {projectData.issues.filter(i => i.status === 'fixed').length}
                                          </div>
                                          <div className="text-sm text-gray-400">Behoben</div>
                                          <div className="text-xs text-gray-500 mt-1">
                                            {Math.round((projectData.issues.filter(i => i.status === 'fixed').length / projectData.issues.length) * 100)}% Fortschritt
                                          </div>
                                        </div>
                                      </div>
                            
                                      <div className="bg-complyo-gray/50 rounded-xl p-6 border border-complyo-accent/20">
                                        <div className="text-center">
                                          <div className="text-3xl font-bold text-complyo-accent mb-2">
                                            {projectData.active_fix_tasks.length}
                                          </div>
                                          <div className="text-sm text-gray-400">Aktive Fixes</div>
                                          <div className="text-xs text-gray-500 mt-1">
                                            {projectData.active_fix_tasks.filter(t => t.status === 'in_progress').length} in Bearbeitung
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                            
                                    {/* Tabs */}
                                    <div className="border-b border-complyo-primary/20 mb-8">
                                      <nav className="-mb-px flex space-x-8">
                                        {[
                                          { id: 'overview', label: 'Übersicht' },
                                          { id: 'issues', label: 'Issues' },
                                          { id: 'progress', label: 'Fortschritt' },
                                          { id: 'fixes', label: 'Fixes' }
                                        ].map(tab => (
                                          <button
                                            key={tab.id}
                                            onClick={() => setActiveTab(tab.id as any)}
                                            className={`py-2 px-1 border-b-2 font-medium text-sm transition-colors ${
                                              activeTab === tab.id
                                                ? 'border-complyo-primary text-complyo-primary'
                                                : 'border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300'
                                            }`}
                                          >
                                            {tab.label}
                                          </button>
                                        ))}
                                      </nav>
                                    </div>
                            
                                    {/* Tab Content */}
                                    {activeTab === 'overview' && (
                                      <div className="space-y-6">
                                        {/* Latest Analysis */}
                                        {projectData.latest_analysis && (
                                          <div className="bg-complyo-gray/50 rounded-xl p-6 border border-complyo-primary/20">
                                            <h3 className="text-xl font-bold mb-4">Letzte Analyse</h3>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                              <div>
                                                <p className="text-gray-400 mb-2">Scan-Zeitpunkt</p>
                                                <p className="font-medium">
                                                  {format(new Date(projectData.latest_analysis.scan_timestamp), 'dd.MM.yyyy HH:mm', { locale: de })}
                                                </p>
                                              </div>
                                              <div>
                                                <p className="text-gray-400 mb-2">Gefundene Issues</p>
                                                <p className="font-medium">{projectData.latest_analysis.total_issues}</p>
                                              </div>
                                            </div>
                                          </div>
                                        )}
                            
                                        {/* Quick Actions */}
                                        <div className="bg-complyo-gray/50 rounded-xl p-6 border border-complyo-primary/20">
                                          <h3 className="text-xl font-bold mb-4">Schnellaktionen</h3>
                                          <div className="flex flex-wrap gap-4">
                                            <button 
                                              onClick={() => {/* Trigger new scan */}}
                                              className="bg-complyo-primary hover:bg-complyo-primary/80 px-4 py-2 rounded-lg transition-colors"
                                            >
                                              Erneut scannen
                                            </button>
                                            <button 
                                              onClick={() => {/* Export report */}}
                                              className="bg-complyo-accent hover:bg-complyo-accent/80 px-4 py-2 rounded-lg transition-colors"
                                            >
                                              PDF-Report erstellen
                                            </button>
                                            <button 
                                              onClick={() => {/* Start fixes */}}
                                              className="bg-complyo-secondary hover:bg-complyo-secondary/80 px-4 py-2 rounded-lg transition-colors"
                                            >
                                              Fixes starten
                                            </button>
                                          </div>
                                        </div>
                                      </div>
                                    )}
                            
                                    {activeTab === 'issues' && (
                                      <div className="space-y-4">
                                        {projectData.issues.length === 0 ? (
                                          <div className="text-center py-12">
                                            <div className="text-6xl mb-4">🎉</div>
                                            <h3 className="text-xl font-bold mb-2">Keine Issues gefunden!</h3>
                                            <p className="text-gray-400">Ihre Website ist vollständig compliance-konform.</p>
                                          </div>
                                        ) : (
                                          projectData.issues.map(issue => (
                                            <div key={issue.id} className="bg-complyo-gray/50 rounded-xl p-6 border border-complyo-primary/20">
                                              <div className="flex items-start justify-between mb-4">
                                                <div className="flex items-start space-x-4">
                                                  <div className="text-2xl">{getCategoryIcon(issue.category)}</div>
                                                  <div className="flex-1">
                                                    <div className="flex items-center space-x-3 mb-2">
                                                      <h3 className="font-semibold text-white">{issue.title}</h3>
                                                      <span className={`px-2 py-1 rounded-full text-xs font-medium ${getSeverityColor(issue.severity)}`}>
                                                        {issue.severity}
                                                      </span>
                                                      <span className={`px-2 py-1 rounded-full text-xs font-medium ${
                                                        issue.status === 'fixed' ? 'text-green-400 bg-green-500/20' : 
                                                        issue.status === 'in_progress' ? 'text-blue-400 bg-blue-500/20' : 
                                                        'text-gray-400 bg-gray-500/20'
                                                      }`}>
                                                        {issue.status === 'fixed' ? 'Behoben' : 
                                                         issue.status === 'in_progress' ? 'In Bearbeitung' : 'Offen'}
                                                      </span>
                                                    </div>
                                                    <p className="text-gray-400 text-sm mb-3">{issue.description}</p>
                                                    <div className="flex items-center space-x-4 text-xs text-gray-500">
                                                      <span>Kategorie: {issue.category}</span>
                                                      {issue.estimated_fix_time && (
                                                        <span>Geschätzte Bearbeitungszeit: {issue.estimated_fix_time} Min.</span>
                                                      )}
                                                      <span>Erstellt: {format(new Date(issue.created_at), 'dd.MM.yyyy', { locale: de })}</span>
                                                    </div>
                                                  </div>
                                                </div>
                                                <div className="flex space-x-2">
                                                  {issue.ai_fix_available && issue.status === 'open' && (
                                                    <button className="bg-complyo-secondary hover:bg-complyo-secondary/80 px-3 py-1 rounded text-xs transition-colors">
                                                      KI-Fix verfügbar
                                                    </button>
                                                  )}
                                                  {issue.status === 'open' && (
                                                    <button className="bg-complyo-primary hover:bg-complyo-primary/80 px-3 py-1 rounded text-xs transition-colors">
                                                      Fix starten
                                                    </button>
                                                  )}
                                                </div>
                                              </div>
                                            </div>
                                          ))
                                        )}
                                      </div>
                                    )}
                            
                                    {activeTab === 'progress' && (
                                      <div className="space-y-6">
                                        {/* Progress Chart */}
                                        {projectData.progress_history.length > 0 && (
                                          <div className="bg-complyo-gray/50 rounded-xl p-6 border border-complyo-primary/20">
                                            <h3 className="text-xl font-bold mb-4">Compliance-Score Verlauf</h3>
                                            <div className="h-64">
                                              <ResponsiveContainer width="100%" height="100%">
                                                <LineChart data={projectData.progress_history}>
                                                  <CartesianGrid strokeDasharray="3 3" stroke="#374151" />
                                                  <XAxis 
                                                    dataKey="date" 
                                                    stroke="#9CA3AF"
                                                    tickFormatter={(value) => format(new Date(value), 'dd.MM', { locale: de })}
                                                  />
                                                  <YAxis stroke="#9CA3AF" domain={[0, 100]} />
                                                  <Tooltip 
                                                    contentStyle={{ 
                                                      backgroundColor: '#1e293b', 
                                                      border: '1px solid #6366f1',
                                                      borderRadius: '8px'
                                                    }}
                                                    labelFormatter={(value) => format(new Date(value), 'dd.MM.yyyy HH:mm', { locale: de })}
                                                  />
                                                  <Line 
                                                    type="monotone" 
                                                    dataKey="score" 
                                                    stroke="#6366f1" 
                                                    strokeWidth={3}
                                                    dot={{ fill: '#6366f1', strokeWidth: 2, r: 4 }}
                                                    activeDot={{ r: 6, stroke: '#6366f1', strokeWidth: 2 }}
                                                  />
                                                </LineChart>
                                              </ResponsiveContainer>
                                            </div>
                                          </div>
                                        )}
                            
                                        {/* Progress Summary */}
                                        <div className="bg-complyo-gray/50 rounded-xl p-6 border border-complyo-primary/20">
                                          <h3 className="text-xl font-bold mb-4">Fortschritts-Zusammenfassung</h3>
                                          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                            <div className="text-center">
                                              <div className="text-2xl font-bold text-complyo-primary mb-2">
                                                {projectData.project.current_score}
                                              </div>
                                              <div className="text-sm text-gray-400">Aktueller Score</div>
                                            </div>
                                            <div className="text-center">
                                              <div className="text-2xl font-bold text-complyo-accent mb-2">
                                                {projectData.project.target_score}
                                              </div>
                                              <div className="text-sm text-gray-400">Ziel-Score</div>
                                            </div>
                                            <div className="text-center">
                                              <div className="text-2xl font-bold text-green-400 mb-2">
                                                {Math.round((projectData.project.current_score / projectData.project.target_score) * 100)}%
                                              </div>
                                              <div className="text-sm text-gray-400">Ziel erreicht</div>
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                    )}
                            
                                    {activeTab === 'fixes' && (
                                      <div className="space-y-4">
                                        {projectData.active_fix_tasks.length === 0 ? (
                                          <div className="text-center py-12">
                                            <div className="text-4xl mb-4">🔧</div>
                                            <h3 className="text-xl font-bold mb-2">Keine aktiven Fixes</h3>
                                            <p className="text-gray-400 mb-4">Starten Sie Fixes für offene Issues</p>
                                            <button className="bg-complyo-primary hover:bg-complyo-primary/80 px-6 py-3 rounded-lg transition-colors">
                                              Fixes starten
                                            </button>
                                          </div>
                                        ) : (
                                          projectData.active_fix_tasks.map(task => {
                                            const issue = projectData.issues.find(i => i.id === task.issue_id);
                                            return (
                                              <div key={task.id} className="bg-complyo-gray/50 rounded-xl p-6 border border-complyo-primary/20">
                                                <div className="flex items-center justify-between mb-4">
                                                  <div className="flex items-center space-x-4">
                                                    <div className="text-2xl">{getCategoryIcon(issue?.category || 'general')}</div>
                                                    <div>
                                                      <h3 className="font-semibold text-white">{issue?.title || 'Fix Task'}</h3>
                                                      <p className="text-gray-400 text-sm">
                                                        {task.task_type === 'ai_fix' ? 'KI-Automatisierung' : 'Experten-Bearbeitung'}
                                                      </p>
                                                    </div>
                                                  </div>
                                                  <div className="flex items-center space-x-3">
                                                    <span className={`px-3 py-1 rounded-full text-sm font-medium ${
                                                      task.status === 'completed' ? 'text-green-400 bg-green-500/20' :
                                                      task.status === 'in_progress' ? 'text-blue-400 bg-blue-500/20' :
                                                      task.status === 'failed' ? 'text-red-400 bg-red-500/20' :
                                                      'text-yellow-400 bg-yellow-500/20'
                                                    }`}>
                                                      {task.status === 'completed' ? 'Abgeschlossen' :
                                                       task.status === 'in_progress' ? 'In Bearbeitung' :
                                                       task.status === 'failed' ? 'Fehlgeschlagen' : 'Wartend'}
                                                    </span>
                                                    {task.status === 'in_progress' && (
                                                      <div className="animate-spin w-5 h-5 border-2 border-complyo-primary border-t-transparent rounded-full"></div>
                                                    )}
                                                  </div>
                                                </div>
                                                
                                                <div className="flex items-center justify-between text-sm text-gray-400">
                                                  <span>Bearbeitet von: {task.assigned_to}</span>
                                                  <span>Gestartet: {format(new Date(task.created_at), 'dd.MM.yyyy HH:mm', { locale: de })}</span>
                                                </div>
                                                
                                                {task.status === 'in_progress' && task.task_type === 'ai_fix' && (
                                                  <div className="mt-4 bg-complyo-dark/50 rounded-lg p-4">
                                                    <div className="flex items-center space-x-2 mb-2">
                                                      <div className="animate-pulse w-2 h-2 bg-complyo-primary rounded-full"></div>
                                                      <span className="text-sm text-complyo-primary">KI generiert Lösung...</span>
                                                    </div>
                                                    <div className="w-full bg-complyo-dark rounded-full h-2">
                                                      <div className="bg-gradient-to-r from-complyo-primary to-complyo-accent h-2 rounded-full animate-pulse" style={{ width: '60%' }}></div>
                                                    </div>
                                                  </div>
                                                )}
                                              </div>
                                            );
                                          })
                                        )}
                                      </div>
                                    )}
                                  </div>
                                </div>
                              );
                            };
                            
                            export default ProjectDetail;
                            
                            // === AI PROGRESS TRACKING PAGE ===
                            // pages/project/[id]/ai-progress.tsx
                            import React, { useState, useEffect } from 'react';
                            import { useRouter } from 'next/router';
                            import { format } from 'date-fns';
                            import { de } from 'date-fns/locale';
                            
                            interface AIProgressData {
                              total_tasks: number;
                              completed_tasks: number;
                              in_progress_tasks: number;
                              failed_tasks: number;
                              progress_percentage: number;
                              status: string;
                              tasks: Array<{
                                id: string;
                                issue_title: string;
                                status: string;
                                completion_notes: string;
                                created_at: string;
                                completed_at: string;
                              }>;
                            }
                            
                            const AIProgress: React.FC = () => {
                              const [progressData, setProgressData] = useState<AIProgressData | null>(null);
                              const [loading, setLoading] = useState(true);
                              const router = useRouter();
                              const { id } = router.query;
                            
                              useEffect(() => {
                                if (id) {
                                  fetchProgressData();
                                  // Poll for updates every 10 seconds
                                  const interval = setInterval(fetchProgressData, 10000);
                                  return () => clearInterval(interval);
                                }
                              }, [id]);
                            
                              const fetchProgressData = async () => {
                                try {
                                  const token = localStorage.getItem('complyo_auth_token');
                                  const response = await fetch(`https://api.complyo.tech/api/ai/progress/${id}`, {
                                    headers: {
                                      'Authorization': `Bearer ${token}`,
                                      'Content-Type': 'application/json'
                                    }
                                  });
                            
                                  if (response.ok) {
                                    const data = await response.json();
                                    setProgressData(data);
                                  }
                                } catch (error) {
                                  console.error('Failed to fetch progress data:', error);
                                } finally {
                                  setLoading(false);
                                }
                              };
                            
                              const getTaskStatusIcon = (status: string) => {
                                switch (status) {
                                  case 'completed':
                                    return '✅';
                                  case 'in_progress':
                                    return '🔄';
                                  case 'failed':
                                    return '❌';
                                  default:
                                    return '⏳';
                                }
                              };
                            
                              const getTaskStatusColor = (status: string) => {
                                switch (status) {
                                  case 'completed':
                                    return 'text-green-400 bg-green-500/20';
                                  case 'in_progress':
                                    return 'text-blue-400 bg-blue-500/20';
                                  case 'failed':
                                    return 'text-red-400 bg-red-500/20';
                                  default:
                                    return 'text-yellow-400 bg-yellow-500/20';
                                }
                              };
                            
                              if (loading) {
                                return (
                                  <div className="min-h-screen bg-complyo-dark flex items-center justify-center">
                                    <div className="text-center">
                                      <div className="animate-spin w-12 h-12 border-4 border-complyo-primary border-t-transparent rounded-full mx-auto mb-4"></div>
                                      <p className="text-gray-300">KI-Fortschritt wird geladen...</p>
                                    </div>
                                  </div>
                                );
                              }
                            
                              return (
                                <div className="min-h-screen bg-complyo-dark text-white">
                                  {/* Header */}
                                  <header className="bg-complyo-gray border-b border-complyo-primary/20">
                                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                      <div className="flex justify-between items-center h-16">
                                        <div className="flex items-center">
                                          <button 
                                            onClick={() => router.push(`/project/${id}`)}
                                            className="mr-4 text-gray-400 hover:text-white transition-colors"
                                          >
                                            ← Zurück zum Projekt
                                          </button>
                                          <h1 className="text-2xl font-bold bg-gradient-to-r from-complyo-primary to-complyo-accent bg-clip-text text-transparent">
                                            KI-Automatisierung
                                          </h1>
                                        </div>
                                      </div>
                                    </div>
                                  </header>
                            
                                  <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                                    {/* Progress Overview */}
                                    <div className="bg-complyo-gray/50 rounded-xl p-8 border border-complyo-primary/20 mb-8">
                                      <div className="text-center mb-8">
                                        <h2 className="text-3xl font-bold mb-4">KI bearbeitet Ihre Website</h2>
                                        <div className="text-6xl font-bold text-complyo-primary mb-4">
                                          {progressData?.progress_percentage || 0}%
                                        </div>
                                        <p className="text-gray-300 mb-6">
                                          {progressData?.completed_tasks || 0} von {progressData?.total_tasks || 0} Tasks abgeschlossen
                                        </p>
                                        
                                        {/* Progress Bar */}
                                        <div className="w-full bg-complyo-dark rounded-full h-4 mb-6 overflow-hidden">
                                          <div 
                                            className="bg-gradient-to-r from-complyo-primary to-complyo-accent h-4 rounded-full transition-all duration-500 ease-out relative"
                                            style={{ width: `${progressData?.progress_percentage || 0}%` }}
                                          >
                                            <div className="absolute inset-0 bg-white/20 animate-pulse"></div>
                                          </div>
                                        </div>
                            
                                        {/* Status */}
                                        <div className="flex justify-center space-x-8">
                                          <div className="text-center">
                                            <div className="text-2xl font-bold text-green-400">{progressData?.completed_tasks || 0}</div>
                                            <div className="text-sm text-gray-400">Abgeschlossen</div>
                                          </div>
                                          <div className="text-center">
                                            <div className="text-2xl font-bold text-blue-400">{progressData?.in_progress_tasks || 0}</div>
                                            <div className="text-sm text-gray-400">In Bearbeitung</div>
                                          </div>
                                          <div className="text-center">
                                            <div className="text-2xl font-bold text-red-400">{progressData?.failed_tasks || 0}</div>
                                            <div className="text-sm text-gray-400">Fehlgeschlagen</div>
                                          </div>
                                        </div>
                                      </div>
                            
                                      {/* Live Status */}
                                      {progressData?.in_progress_tasks && progressData.in_progress_tasks > 0 && (
                                        <div className="bg-complyo-primary/10 border border-complyo-primary/20 rounded-lg p-4 text-center">
                                          <div className="flex items-center justify-center space-x-2 mb-2">
                                            <div className="animate-spin w-4 h-4 border-2 border-complyo-primary border-t-transparent rounded-full"></div>
                                            <span className="text-complyo-primary font-medium">KI arbeitet aktiv an Ihren Compliance-Issues</span>
                                          </div>
                                          <p className="text-gray-300 text-sm">Geschätzte Restzeit: 2-4 Stunden</p>
                                        </div>
                                      )}
                            
                                      {progressData?.progress_percentage === 100 && (
                                        <div className="bg-green-500/10 border border-green-500/20 rounded-lg p-4 text-center">
                                          <div className="text-2xl mb-2">🎉</div>
                                          <div className="text-green-400 font-medium mb-2">KI-Automatisierung abgeschlossen!</div>
                                          <p className="text-gray-300 text-sm mb-4">Alle verfügbaren Fixes wurden implementiert.</p>
                                          <button 
                                            onClick={() => router.push(`/project/${id}`)}
                                            className="bg-green-500 hover:bg-green-600 px-6 py-2 rounded-lg transition-colors"
                                          >
                                            Ergebnisse anzeigen
                                          </button>
                                        </div>
                                      )}
                                    </div>
                            
                                    {/* Task Details */}
                                    <div className="space-y-4">
                                      <h3 className="text-xl font-bold mb-4">Task-Details</h3>
                                      
                                      {progressData?.tasks?.map(task => (
                                        <div key={task.id} className="bg-complyo-gray/50 rounded-xl p-6 border border-complyo-primary/20">
                                          <div className="flex items-start justify-between">
                                            <div className="flex items-start space-x-4">
                                              <div className="text-2xl">{getTaskStatusIcon(task.status)}</div>
                                              <div className="flex-1">
                                                <h4 className="font-semibold text-white mb-2">{task.issue_title}</h4>
                                                {task.completion_notes && (
                                                  <p className="text-gray-400 text-sm mb-3">{task.completion_notes}</p>
                                                )}
                                                <div className="flex items-center space-x-4 text-xs text-gray-500">
                                                  <span>Gestartet: {format(new Date(task.created_at), 'dd.MM.yyyy HH:mm', { locale: de })}</span>
                                                  {task.completed_at && (
                                                    <span>Abgeschlossen: {format(new Date(task.completed_at), 'dd.MM.yyyy HH:mm', { locale: de })}</span>
                                                  )}
                                                </div>
                                              </div>
                                            </div>
                                            <span className={`px-3 py-1 rounded-full text-sm font-medium ${getTaskStatusColor(task.status)}`}>
                                              {task.status === 'completed' ? 'Abgeschlossen' :
                                               task.status === 'in_progress' ? 'In Bearbeitung' :
                                               task.status === 'failed' ? 'Fehlgeschlagen' : 'Wartend'}
                                            </span>
                                          </div>
                                          
                                          {task.status === 'in_progress' && (
                                            <div className="mt-4 bg-complyo-dark/50 rounded-lg p-3">
                                              <div className="flex items-center space-x-2">
                                                <div className="animate-pulse w-2 h-2 bg-complyo-primary rounded-full"></div>
                                                <span className="text-sm text-complyo-primary">KI generiert optimierte Lösung...</span>
                                              </div>
                                            </div>
                                          )}
                                        </div>
                                      ))}
                                    </div>
                            
                                    {/* What's Happening Info */}
                                    <div className="mt-12 bg-complyo-gray/50 rounded-xl p-6 border border-complyo-accent/20">
                                      <h3 className="text-xl font-bold mb-4 text-complyo-accent">Was passiert gerade?</h3>
                                      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                        <div>
                                          <h4 className="font-semibold mb-2">🤖 KI-Analyse</h4>
                                          <p className="text-gray-400 text-sm">
                                            Unsere KI analysiert Ihre Website-Struktur und generiert passgenaue Compliance-Lösungen.
                                          </p>
                                        </div>
                                        <div>
                                          <h4 className="font-semibold mb-2">📝 Code-Generierung</h4>
                                          <p className="text-gray-400 text-sm">
                                            Impressum, Datenschutzerklärung und Cookie-Banner werden automatisch erstellt.
                                          </p>
                                        </div>
                                        <div>
                                          <h4 className="font-semibold mb-2">🔧 Implementierung</h4>
                                          <p className="text-gray-400 text-sm">
                                            Die generierten Lösungen werden für Ihre Website optimiert und bereitgestellt.
                                          </p>
                                        </div>
                                        <div>
                                          <h4 className="font-semibold mb-2">✅ Validierung</h4>
                                          <p className="text-gray-400 text-sm">
                                            Abschließende Überprüfung der Compliance-Konformität und Funktionalität.
                                          </p>
                                        </div>
                                      </div>
                                    </div>
                            
                                    {/* Next Steps */}
                                    {progressData?.progress_percentage === 100 && (
                                      <div className="mt-8 bg-complyo-primary/10 border border-complyo-primary/20 rounded-xl p-6">
                                        <h3 className="text-xl font-bold mb-4 text-complyo-primary">Nächste Schritte</h3>
                                        <ul className="space-y-2 text-gray-300">
                                          <li className="flex items-center space-x-2">
                                            <span className="text-complyo-primary">1.</span>
                                            <span>Überprüfen Sie die implementierten Lösungen in Ihrem Projekt-Dashboard</span>
                                          </li>
                                          <li className="flex items-center space-x-2">
                                            <span className="text-complyo-primary">2.</span>
                                            <span>Laden Sie den detaillierten Compliance-Report herunter</span>
                                          </li>
                                          <li className="flex items-center space-x-2">
                                            <span className="text-complyo-primary">3.</span>
                                            <span>Implementieren Sie die generierten Code-Snippets auf Ihrer Website</span>
                                          </li>
                                          <li className="flex items-center space-x-2">
                                            <span className="text-complyo-primary">4.</span>
                                            <span>Aktivieren Sie das kontinuierliche Monitoring für automatische Updates</span>
                                          </li>
                                        </ul>
                                      </div>
                                    )}
                                  </div>
                                </div>
                              );
                            };
                            
                            export default AIProgress;
                            
                            // === LOGIN PAGE ===
                            // pages/login.tsx
                            import React, { useState } from 'react';
                            import { useRouter } from 'next/router';
                            
                            const Login: React.FC = () => {
                              const [email, setEmail] = useState('');
                              const [loading, setLoading] = useState(false);
                              const [error, setError] = useState('');
                              const router = useRouter();
                            
                              const handleLogin = async (e: React.FormEvent) => {
                                e.preventDefault();
                                setLoading(true);
                                setError('');
                            
                                try {
                                  // In real implementation, this would call your authentication API
                                  // For now, redirect to dashboard if user has token from onboarding
                                  const token = localStorage.getItem('complyo_auth_token');
                                  if (token) {
                                    router.push('/dashboard');
                                  } else {
                                    setError('Keine gültige Sitzung gefunden. Bitte starten Sie eine neue Analyse.');
                                    setTimeout(() => {
                                      router.push('/');
                                    }, 3000);
                                  }
                                } catch (err) {
                                  setError('Anmeldung fehlgeschlagen. Bitte versuchen Sie es erneut.');
                                } finally {
                                  setLoading(false);
                                }
                              };
                            
                              return (
                                <div className="min-h-screen bg-complyo-dark flex items-center justify-center">
                                  <div className="max-w-md w-full bg-complyo-gray/50 rounded-xl p-8 border border-complyo-primary/20">
                                    <div className="text-center mb-8">
                                      <h1 className="text-3xl font-bold bg-gradient-to-r from-complyo-primary to-complyo-accent bg-clip-text text-transparent mb-2">
                                        Complyo
                                      </h1>
                                      <p className="text-gray-400">Anmeldung zu Ihrem Dashboard</p>
                                    </div>
                            
                                    <form onSubmit={handleLogin} className="space-y-6">
                                      <div>
                                        <label className="block text-sm font-medium mb-2">E-Mail-Adresse</label>
                                        <input 
                                          type="email" 
                                          value={email}
                                          onChange={(e) => setEmail(e.target.value)}
                                          placeholder="ihre@email.de" 
                                          className="w-full px-4 py-3 bg-complyo-dark border border-complyo-primary/30 rounded-lg focus:border-complyo-primary focus:ring-2 focus:ring-complyo-primary/20 outline-none transition-all text-white"
                                          required
                                        />
                                      </div>
                            
                                      {error && (
                                        <div className="bg-red-500/10 border border-red-500/20 rounded-lg p-3">
                                          <p className="text-red-400 text-sm">{error}</p>
                                        </div>
                                      )}
                            
                                      <button 
                                        type="submit"
                                        disabled={loading}
                                        className="w-full bg-gradient-to-r from-complyo-primary to-complyo-secondary hover:from-complyo-primary/80 hover:to-complyo-secondary/80 px-6 py-3 rounded-lg font-semibold transition-all disabled:opacity-50"
                                      >
                                        {loading ? 'Anmeldung läuft...' : 'Anmelden'}
                                      </button>
                                    </form>
                            
                                    <div className="mt-6 text-center">
                                      <p className="text-gray-400 text-sm">
                                        Noch kein Account? {' '}
                                        <button 
                                          onClick={() => router.push('/')}
                                          className="text-complyo-primary hover:text-complyo-primary/80 transition-colors"
                                        >
                                          Kostenlose Analyse starten
                                        </button>
                                      </p>
                                    </div>
                            
                                    <div className="mt-8 text-center">
                                      <p className="text-gray-500 text-xs">
                                        Nach erfolgreicher Zahlung erhalten Sie automatisch Zugang zu Ihrem Dashboard.
                                      </p>
                                    </div>
                                  </div>
                                </div>
                              );
                            };
                            















                            #!/bin/bash
                            # COMPLYO - VOLLSTÄNDIGES DEPLOYMENT SCRIPT
                            # Server: 85.215.125.171
                            # Führe alle Schritte nacheinander aus
                            
                            echo "🚀 COMPLYO DEPLOYMENT GESTARTET"
                            echo "=================================="
                            
                            # 1. NEUE LANDING PAGE DEPLOYEN
                            echo "📄 Schritt 1: Landing Page aktualisieren"
                            cd /opt/projects/saas-project-2
                            
                            # Backup der aktuellen Landing Page
                            docker stop complyo-landing 2>/dev/null || true
                            docker rm complyo-landing 2>/dev/null || true
                            
                            # Neue Landing Page erstellen
                            mkdir -p landing-v2
                            cd landing-v2
                            
                            # HTML aus Artifact kopieren (manuell einfügen)
                            cat > index.html << 'EOF'
                            # [HIER DEN KOMPLETTEN HTML-CODE AUS DER LANDING PAGE ARTIFACT EINFÜGEN]
                            # Von <!DOCTYPE html> bis </html>
                            EOF
                            
                            # Dockerfile für Landing Page
                            cat > Dockerfile << 'EOF'
                            FROM nginx:alpine
                            COPY index.html /usr/share/nginx/html/
                            EXPOSE 80
                            EOF
                            
                            # Container bauen und starten
                            docker build -t complyo-landing-v2 .
                            docker run -d \
                              --name complyo-landing \
                              --network proxy-network \
                              -e VIRTUAL_HOST=complyo.tech \
                              -e LETSENCRYPT_HOST=complyo.tech \
                              -e LETSENCRYPT_EMAIL=admin@panoart360.de \
                              -e VIRTUAL_PORT=80 \
                              --restart unless-stopped \
                              complyo-landing-v2
                            
                            echo "✅ Landing Page deployed auf https://complyo.tech"
                            
                            # 2. BACKEND ERWEITERN
                            echo "🔧 Schritt 2: Backend erweitern"
                            cd /opt/projects/saas-project-2/legal/backend
                            
                            # Backup der aktuellen main.py
                            cp main.py main.py.backup.$(date +%Y%m%d_%H%M%S)
                            
                            # Database Models erweitern
                            cat > models.py << 'EOF'
                            # [HIER DEN KOMPLETTEN MODELS.PY CODE AUS DER BACKEND ARTIFACT EINFÜGEN]
                            EOF
                            
                            # Neue requirements.txt mit zusätzlichen Dependencies
                            cat >> requirements.txt << 'EOF'
                            # AI & Automation
                            openai==1.3.0
                            anthropic==0.7.7
                            celery==5.3.4
                            redis==5.0.1
                            
                            # Payment & Auth
                            stripe==7.8.0
                            python-jose[cryptography]==3.3.0
                            passlib[bcrypt]==1.7.4
                            
                            # Email & Communications
                            sendgrid==6.10.0
                            python-multipart==0.0.6
                            
                            # Date handling
                            python-dateutil==2.8.2
                            
                            # Enhanced web scraping
                            selenium==4.15.2
                            playwright==1.40.0
                            EOF
                            
                            # Erweiterte main.py mit allen neuen Endpoints
                            cat > main_extended.py << 'EOF'
                            # [HIER DEN KOMPLETTEN MAIN.PY CODE AUS DER BACKEND ARTIFACT EINFÜGEN]
                            EOF
                            
                            # KI-Automation Engine hinzufügen
                            cat > ai_automation.py << 'EOF'
                            # [HIER DEN KOMPLETTEN AI_AUTOMATION.PY CODE AUS DER AI ARTIFACT EINFÜGEN]
                            EOF
                            
                            # Email Service hinzufügen
                            cat > email_service.py << 'EOF'
                            import os
                            import sendgrid
                            from sendgrid.helpers.mail import Mail
                            import logging
                            
                            logger = logging.getLogger(__name__)
                            
                            class EmailService:
                                def __init__(self):
                                    self.sg = sendgrid.SendGridAPIClient(api_key=os.environ.get('SENDGRID_API_KEY'))
                                    self.from_email = "noreply@complyo.tech"
                                
                                async def send_analysis_report(self, user_email: str, analysis_result: dict, checkout_token: str):
                                    """Send detailed analysis report via email"""
                                    try:
                                        html_content = f"""
                                        <html>
                                        <body style="font-family: Arial, sans-serif; background-color: #0f172a; color: #ffffff; padding: 20px;">
                                            <div style="max-width: 600px; margin: 0 auto; background-color: #1e293b; padding: 30px; border-radius: 12px;">
                                                <h1 style="color: #6366f1; text-align: center;">Complyo - Ihre Website-Analyse</h1>
                                                
                                                <div style="background-color: #0f172a; padding: 20px; border-radius: 8px; margin: 20px 0;">
                                                    <h2>Compliance-Score: {analysis_result.get('overall_score', 0)}/100</h2>
                                                    <p>Gefundene Issues: {analysis_result.get('total_issues', 0)}</p>
                                                    <p>Abmahn-Risiko: 4.000€ - 20.000€+ ohne Compliance-Schutz</p>
                                                </div>
                                                
                                                <h3>Gefundene Probleme:</h3>
                                                <ul>
                                                    {''.join([f"<li>{result.get('message', 'Issue')}</li>" for result in analysis_result.get('results', [])])}
                                                </ul>
                                                
                                                <div style="text-align: center; margin: 30px 0;">
                                                    <a href="https://app.complyo.tech/checkout?token={checkout_token}&plan=ai" 
                                                       style="background: linear-gradient(to right, #6366f1, #8b5cf6); color: white; padding: 15px 30px; text-decoration: none; border-radius: 8px; display: inline-block;">
                                                       KI-Fixes für 39€/Monat starten
                                                    </a>
                                                </div>
                                                
                                                <div style="text-align: center; margin: 20px 0;">
                                                    <a href="https://app.complyo.tech/checkout?token={checkout_token}&plan=expert" 
                                                       style="background: linear-gradient(to right, #8b5cf6, #06b6d4); color: white; padding: 15px 30px; text-decoration: none; border-radius: 8px; display: inline-block;">
                                                       Experten-Service buchen
                                                    </a>
                                                </div>
                                            </div>
                                        </body>
                                        </html>
                                        """
                                        
                                        message = Mail(
                                            from_email=self.from_email,
                                            to_emails=user_email,
                                            subject="Ihre Website-Compliance-Analyse ist fertig!",
                                            html_content=html_content
                                        )
                                        
                                        response = self.sg.send(message)
                                        logger.info(f"Analysis email sent to {user_email}")
                                        
                                    except Exception as e:
                                        logger.error(f"Failed to send analysis email: {str(e)}")
                                
                                async def send_ai_completion_email(self, user_email: str, project_name: str, old_score: int, new_score: int, project_url: str):
                                    """Send AI completion notification"""
                                    try:
                                        html_content = f"""
                                        <html>
                                        <body style="font-family: Arial, sans-serif; background-color: #0f172a; color: #ffffff; padding: 20px;">
                                            <div style="max-width: 600px; margin: 0 auto; background-color: #1e293b; padding: 30px; border-radius: 12px;">
                                                <h1 style="color: #22c55e; text-align: center;">🎉 KI-Fixes abgeschlossen!</h1>
                                                
                                                <div style="background-color: #0f172a; padding: 20px; border-radius: 8px; margin: 20px 0;">
                                                    <h2>{project_name}</h2>
                                                    <p>Ihr Compliance-Score wurde verbessert:</p>
                                                    <p style="font-size: 24px; color: #22c55e;">
                                                        {old_score}/100 → {new_score}/100
                                                    </p>
                                                </div>
                                                
                                                <div style="text-align: center; margin: 30px 0;">
                                                    <a href="{project_url}" 
                                                       style="background: linear-gradient(to right, #6366f1, #8b5cf6); color: white; padding: 15px 30px; text-decoration: none; border-radius: 8px; display: inline-block;">
                                                       Ergebnisse anzeigen
                                                    </a>
                                                </div>
                                            </div>
                                        </body>
                                        </html>
                                        """
                                        
                                        message = Mail(
                                            from_email=self.from_email,
                                            to_emails=user_email,
                                            subject="Ihre Website ist jetzt rechtssicher! 🎉",
                                            html_content=html_content
                                        )
                                        
                                        response = self.sg.send(message)
                                        logger.info(f"AI completion email sent to {user_email}")
                                        
                                    except Exception as e:
                                        logger.error(f"Failed to send AI completion email: {str(e)}")
                            
                            # Global instance
                            email_service = EmailService()
                            
                            # Helper functions for import in main.py
                            async def send_analysis_report(user_email: str, analysis_result: dict, checkout_token: str):
                                await email_service.send_analysis_report(user_email, analysis_result, checkout_token)
                            
                            async def send_ai_completion_email(user_email: str, project_name: str, old_score: int, new_score: int, project_url: str):
                                await email_service.send_ai_completion_email(user_email, project_name, old_score, new_score, project_url)
                            
                            async def send_expert_welcome_email(user_email: str, project_id: str, calendly_link: str):
                                html_content = f"""
                                <html>
                                <body style="font-family: Arial, sans-serif; background-color: #0f172a; color: #ffffff; padding: 20px;">
                                    <div style="max-width: 600px; margin: 0 auto; background-color: #1e293b; padding: 30px; border-radius: 12px;">
                                        <h1 style="color: #8b5cf6; text-align: center;">Willkommen beim Experten-Service!</h1>
                                        
                                        <p>Vielen Dank für Ihr Vertrauen in unseren Experten-Service.</p>
                                        <p>Bitte buchen Sie Ihren persönlichen Beratungstermin:</p>
                                        
                                        <div style="text-align: center; margin: 30px 0;">
                                            <a href="{calendly_link}" 
                                               style="background: linear-gradient(to right, #8b5cf6, #06b6d4); color: white; padding: 15px 30px; text-decoration: none; border-radius: 8px; display: inline-block;">
                                               Termin buchen
                                            </a>
                                        </div>
                                    </div>
                                </body>
                                </html>
                                """
                                
                                message = Mail(
                                    from_email=email_service.from_email,
                                    to_emails=user_email,
                                    subject="Ihr Experten-Beratungstermin - Jetzt buchen",
                                    html_content=html_content
                                )
                                
                                response = email_service.sg.send(message)
                            
                            async def send_compliance_alert_email(user_email: str, project_name: str, score_change: int, current_score: int, project_url: str):
                                html_content = f"""
                                <html>
                                <body style="font-family: Arial, sans-serif; background-color: #0f172a; color: #ffffff; padding: 20px;">
                                    <div style="max-width: 600px; margin: 0 auto; background-color: #1e293b; padding: 30px; border-radius: 12px;">
                                        <h1 style="color: #ef4444; text-align: center;">⚠️ Compliance-Alert</h1>
                                        
                                        <div style="background-color: #0f172a; padding: 20px; border-radius: 8px; margin: 20px 0;">
                                            <h2>{project_name}</h2>
                                            <p>Ihr Compliance-Score ist gesunken:</p>
                                            <p style="font-size: 24px; color: #ef4444;">
                                                {score_change} Punkte → Aktueller Score: {current_score}/100
                                            </p>
                                        </div>
                                        
                                        <div style="text-align: center; margin: 30px 0;">
                                            <a href="{project_url}" 
                                               style="background: linear-gradient(to right, #ef4444, #f97316); color: white; padding: 15px 30px; text-decoration: none; border-radius: 8px; display: inline-block;">
                                               Jetzt prüfen
                                            </a>
                                        </div>
                                    </div>
                                </body>
                                </html>
                                """
                                
                                message = Mail(
                                    from_email=email_service.from_email,
                                    to_emails=user_email,
                                    subject=f"Compliance-Alert: {project_name}",
                                    html_content=html_content
                                )
                                
                                response = email_service.sg.send(message)
                            EOF
                            
                            # Settings erweitern
                            cat > settings.py << 'EOF'
                            import os
                            from typing import Optional
                            
                            # Database
                            DATABASE_URL = os.getenv("DATABASE_URL", "postgresql://complyo_user:WrsmZTXYcjt0c7lt%2FlOzEnX1N5rtjRklLYrY8zXmBGo%3D@shared-postgres:5432/complyo_db")
                            
                            # Redis
                            REDIS_HOST = os.getenv("REDIS_HOST", "shared-redis")
                            REDIS_PORT = int(os.getenv("REDIS_PORT", "6379"))
                            REDIS_PASSWORD = os.getenv("REDIS_PASSWORD", "04/jdoPGip+v2Yqoeo0+nNSIvxZsC/u+Q+E4qBrGA0E=")
                            REDIS_DB = int(os.getenv("REDIS_DB", "4"))
                            
                            # JWT
                            JWT_SECRET = os.getenv("JWT_SECRET", "9ECBjaQa7KwoyciJtLTQjc/fWRClrsMUXl5LSpIwi+I9y3wPnD1ZAZ6On+WGukAZ2bmkgInnjJjBEeU2xkluEQ==")
                            
                            # AI APIs
                            OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")
                            ANTHROPIC_API_KEY = os.getenv("ANTHROPIC_API_KEY")
                            
                            # Payment
                            STRIPE_SECRET_KEY = os.getenv("STRIPE_SECRET_KEY")
                            STRIPE_PUBLIC_KEY = os.getenv("STRIPE_PUBLIC_KEY")
                            
                            # Email
                            SENDGRID_API_KEY = os.getenv("SENDGRID_API_KEY")
                            
                            # Calendly
                            CALENDLY_API_KEY = os.getenv("CALENDLY_API_KEY")
                            
                            # eRecht24
                            ERECHT24_API_KEY = os.getenv("ERECHT24_API_KEY")
                            EOF
                            
                            # Container neu bauen
                            echo "🔨 Backend Container neu bauen..."
                            cd /opt/projects/saas-project-2
                            docker stop complyo-backend
                            docker build -t complyo-backend-v2 -f legal/Dockerfile ./legal
                            
                            # Container mit erweiterten Environment Variables starten
                            docker run -d \
                              --name complyo-backend-v2 \
                              --network proxy-network \
                              --network shared-network \
                              --network complyo-network \
                              -e ENVIRONMENT=production \
                              -e PORT=8002 \
                              -e DATABASE_URL=postgresql://complyo_user:WrsmZTXYcjt0c7lt%2FlOzEnX1N5rtjRklLYrY8zXmBGo%3D@shared-postgres:5432/complyo_db \
                              -e REDIS_HOST=shared-redis \
                              -e REDIS_PORT=6379 \
                              -e REDIS_PASSWORD=04/jdoPGip+v2Yqoeo0+nNSIvxZsC/u+Q+E4qBrGA0E= \
                              -e REDIS_DB=4 \
                              -e JWT_SECRET=9ECBjaQa7KwoyciJtLTQjc/fWRClrsMUXl5LSpIwi+I9y3wPnD1ZAZ6On+WGukAZ2bmkgInnjJjBEeU2xkluEQ== \
                              -e OPENAI_API_KEY=${OPENAI_API_KEY:-"sk-proj-placeholder"} \
                              -e ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-"sk-ant-placeholder"} \
                              -e STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY:-"sk_test_placeholder"} \
                              -e SENDGRID_API_KEY=${SENDGRID_API_KEY:-"SG.placeholder"} \
                              -e CALENDLY_API_KEY=${CALENDLY_API_KEY:-"cal_placeholder"} \
                              -e VIRTUAL_HOST=api.complyo.tech \
                              -e LETSENCRYPT_HOST=api.complyo.tech \
                              -e LETSENCRYPT_EMAIL=admin@panoart360.de \
                              -e VIRTUAL_PORT=8002 \
                              --restart unless-stopped \
                              complyo-backend-v2
                            
                            # Alten Container entfernen
                            docker rm complyo-backend
                            
                            echo "✅ Backend erweitert und neu deployed"
                            
                            # 3. DATABASE TABLES ERSTELLEN
                            echo "🗄️ Schritt 3: Database Schema aktualisieren"
                            
                            # Python Script für Database Schema
                            cat > create_tables.py << 'EOF'
                            from sqlalchemy import create_engine
                            from models import Base
                            import os
                            
                            DATABASE_URL = "postgresql://complyo_user:WrsmZTXYcjt0c7lt%2FlOzEnX1N5rtjRklLYrY8zXmBGo%3D@shared-postgres:5432/complyo_db"
                            
                            try:
                                engine = create_engine(DATABASE_URL)
                                Base.metadata.create_all(bind=engine)
                                print("✅ Database tables created successfully!")
                            except Exception as e:
                                print(f"❌ Error creating tables: {str(e)}")
                            EOF
                            
                            # Ausführen in Backend Container
                            docker exec complyo-backend-v2 python create_tables.py
                            
                            echo "✅ Database Schema aktualisiert"
                            
                            # 4. DASHBOARD FRONTEND DEPLOYEN
                            echo "🖥️ Schritt 4: Dashboard Frontend deployen"
                            
                            # Dashboard Verzeichnis erstellen
                            mkdir -p dashboard
                            cd dashboard
                            
                            # package.json für Next.js Dashboard
                            cat > package.json << 'EOF'
                            {
                              "name": "complyo-dashboard",
                              "version": "1.0.0",
                              "private": true,
                              "scripts": {
                                "dev": "next dev",
                                "build": "next build",
                                "start": "next start",
                                "lint": "next lint"
                              },
                              "dependencies": {
                                "next": "14.0.0",
                                "react": "18.2.0",
                                "react-dom": "18.2.0",
                                "typescript": "5.2.2",
                                "@types/node": "20.8.0",
                                "@types/react": "18.2.25",
                                "@types/react-dom": "18.2.11",
                                "tailwindcss": "3.3.5",
                                "autoprefixer": "10.4.16",
                                "postcss": "8.4.31",
                                "recharts": "2.8.0",
                                "date-fns": "2.30.0"
                              }
                            }
                            EOF
                            
                            # Next.js Konfiguration
                            cat > next.config.js << 'EOF'
                            /** @type {import('next').NextConfig} */
                            const nextConfig = {
                              output: 'standalone',
                              trailingSlash: true,
                              async redirects() {
                                return [
                                  {
                                    source: '/',
                                    destination: '/dashboard',
                                    permanent: false,
                                  },
                                ]
                              },
                            }
                            
                            module.exports = nextConfig
                            EOF
                            
                            # Tailwind Config
                            cat > tailwind.config.js << 'EOF'
                            /** @type {import('tailwindcss').Config} */
                            module.exports = {
                              content: [
                                './pages/**/*.{js,ts,jsx,tsx,mdx}',
                                './components/**/*.{js,ts,jsx,tsx,mdx}',
                              ],
                              theme: {
                                extend: {
                                  colors: {
                                    'complyo-primary': '#6366f1',
                                    'complyo-secondary': '#8b5cf6',
                                    'complyo-accent': '#06b6d4',
                                    'complyo-dark': '#0f172a',
                                    'complyo-gray': '#1e293b'
                                  }
                                },
                              },
                              plugins: [],
                            }
                            EOF
                            
                            # PostCSS Config
                            cat > postcss.config.js << 'EOF'
                            module.exports = {
                              plugins: {
                                tailwindcss: {},
                                autoprefixer: {},
                              },
                            }
                            EOF
                            
                            # Pages erstellen
                            mkdir -p pages
                            # [HIER WÜRDEN DIE DASHBOARD PAGES AUS DER FRONTEND ARTIFACT EINGEFÜGT]
                            
                            # Dockerfile für Dashboard
                            cat > Dockerfile << 'EOF'
                            FROM node:18-alpine AS base
                            
                            FROM base AS deps
                            WORKDIR /app
                            COPY package*.json ./
                            RUN npm ci
                            
                            FROM base AS builder
                            WORKDIR /app
                            COPY --from=deps /app/node_modules ./node_modules
                            COPY . .
                            RUN npm run build
                            
                            FROM base AS runner
                            WORKDIR /app
                            ENV NODE_ENV production
                            RUN addgroup --system --gid 1001 nodejs
                            RUN adduser --system --uid 1001 nextjs
                            
                            COPY --from=builder /app/public ./public
                            COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
                            COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static
                            
                            USER nextjs
                            EXPOSE 3000
                            ENV PORT 3000
                            
                            CMD ["node", "server.js"]
                            EOF
                            
                            # Dashboard Container bauen und starten
                            docker build -t complyo-dashboard .
                            docker run -d \
                              --name complyo-dashboard \
                              --network proxy-network \
                              -e NEXT_PUBLIC_API_URL=https://api.complyo.tech \
                              -e NEXTAUTH_URL=https://app.complyo.tech \
                              -e VIRTUAL_HOST=app.complyo.tech \
                              -e LETSENCRYPT_HOST=app.complyo.tech \
                              -e LETSENCRYPT_EMAIL=admin@panoart360.de \
                              -e VIRTUAL_PORT=3000 \
                              --restart unless-stopped \
                              complyo-dashboard
                            
                            echo "✅ Dashboard Frontend deployed auf https://app.complyo.tech"
                            
                            # 5. CELERY WORKER FÜR AI AUTOMATION
                            echo "🤖 Schritt 5: Celery Worker für KI-Automation"
                            
                            # Celery Worker Container starten
                            docker run -d \
                              --name complyo-worker \
                              --network shared-network \
                              --network complyo-network \
                              -e DATABASE_URL=postgresql://complyo_user:WrsmZTXYcjt0c7lt%2FlOzEnX1N5rtjRklLYrY8zXmBGo%3D@shared-postgres:5432/complyo_db \
                              -e REDIS_HOST=shared-redis \
                              -e REDIS_PORT=6379 \
                              -e REDIS_PASSWORD=04/jdoPGip+v2Yqoeo0+nNSIvxZsC/u+Q+E4qBrGA0E= \
                              -e REDIS_DB=4 \
                              -e OPENAI_API_KEY=${OPENAI_API_KEY:-"sk-proj-placeholder"} \
                              -e ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-"sk-ant-placeholder"} \
                              -e SENDGRID_API_KEY=${SENDGRID_API_KEY:-"SG.placeholder"} \
                              --restart unless-stopped \
                              complyo-backend-v2 \
                              celery -A ai_automation worker --loglevel=info
                            
                            # Celery Beat Scheduler für tägliche Scans
                            docker run -d \
                              --name complyo-scheduler \
                              --network shared-network \
                              --network complyo-network \
                              -e DATABASE_URL=postgresql://complyo_user:WrsmZTXYcjt0c7lt%2FlOzEnX1N5rtjRklLYrY8zXmBGo%3D@shared-postgres:5432/complyo_db \
                              -e REDIS_HOST=shared-redis \
                              -e REDIS_PORT=6379 \
                              -e REDIS_PASSWORD=04/jdoPGip+v2Yqoeo0+nNSIvxZsC/u+Q+E4qBrGA0E= \
                              -e REDIS_DB=4 \
                              --restart unless-stopped \
                              complyo-backend-v2 \
                              celery -A ai_automation beat --loglevel=info
                            
                            echo "✅ Celery Worker und Scheduler gestartet"
                            
                            # 6. FINAL TESTING
                            echo "🧪 Schritt 6: System-Tests"
                            
                            # Test Landing Page
                            echo "Testing Landing Page..."
                            curl -s -o /dev/null -w "%{http_code}" https://complyo.tech
                            if [ $? -eq 0 ]; then
                                echo "✅ Landing Page erreichbar"
                            else
                                echo "❌ Landing Page Fehler"
                            fi
                            
                            # Test Backend API
                            echo "Testing Backend API..."
                            curl -s -o /dev/null -w "%{http_code}" https://api.complyo.tech/health
                            if [ $? -eq 0 ]; then
                                echo "✅ Backend API erreichbar"
                            else
                                echo "❌ Backend API Fehler"
                            fi
                            
                            # Test Dashboard
                            echo "Testing Dashboard..."
                            curl -s -o /dev/null -w "%{http_code}" https://app.complyo.tech
                            if [ $? -eq 0 ]; then
                                echo "✅ Dashboard erreichbar"
                            else
                                echo "❌ Dashboard Fehler"
                            fi
                            
                            # 7. CONTAINER STATUS OVERVIEW
                            echo ""
                            echo "📊 DEPLOYMENT ÜBERSICHT"
                            echo "======================="
                            docker ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}" | grep complyo
                            
                            echo ""
                            echo "🌐 AKTIVE SERVICES"
                            echo "=================="
                            echo "Landing Page: https://complyo.tech"
                            echo "Backend API:  https://api.complyo.tech"
                            echo "Dashboard:    https://app.complyo.tech"
                            
                            echo ""
                            echo "🎯 NÄCHSTE SCHRITTE"
                            echo "==================="
                            echo "1. API-Keys konfigurieren:"
                            echo "   - OPENAI_API_KEY für GPT-4"
                            echo "   - ANTHROPIC_API_KEY für Claude"
                            echo "   - STRIPE_SECRET_KEY für Payments"
                            echo "   - SENDGRID_API_KEY für E-Mails"
                            echo ""
                            echo "2. Stripe Produkte erstellen:"
                            echo "   - price_ai_monthly_39eur"
                            echo "   - price_expert_setup_2000eur"
                            echo ""
                            echo "3. DNS prüfen:"
                            echo "   - complyo.tech → 85.215.125.171"
                            echo "   - api.complyo.tech → 85.215.125.171"
                            echo "   - app.complyo.tech → 85.215.125.171"
                            echo ""
                            echo "4. SSL-Zertifikate prüfen:"
                            echo "   docker logs letsencrypt"
                            echo ""
                            echo "🚀 COMPLYO DEPLOYMENT ABGESCHLOSSEN!"
                            echo "===================================="
                            
                            # ENVIRONMENT VARIABLES SETUP
                            echo ""
                            echo "⚙️ ENVIRONMENT VARIABLES SETUP"
                            echo "==============================="
                            cat > .env.example << 'EOF'
                            # AI APIs
                            OPENAI_API_KEY=sk-proj-your-openai-key-here
                            ANTHROPIC_API_KEY=sk-ant-your-anthropic-key-here
                            
                            # Payment
                            STRIPE_SECRET_KEY=sk_test_your-stripe-secret-key
                            STRIPE_PUBLIC_KEY=pk_test_your-stripe-public-key
                            
                            # Email
                            SENDGRID_API_KEY=SG.your-sendgrid-api-key
                            
                            # Calendly
                            CALENDLY_API_KEY=your-calendly-api-key
                            
                            # eRecht24
                            ERECHT24_API_KEY=your-erecht24-api-key
                            EOF
                            
                            echo "📝 .env.example erstellt - Bitte mit echten API-Keys ausfüllen"
                            
                            # MONITORING SETUP
                            echo ""
                            echo "📈 MONITORING BEFEHLE"
                            echo "===================="
                            cat > monitor.sh << 'EOF'
                            #!/bin/bash
                            echo "=== COMPLYO SYSTEM STATUS ==="
                            
                            echo "Container Status:"
                            docker ps --format "table {{.Names}}\t{{.Status}}" | grep complyo
                            
                            echo ""
                            echo "Service Health Checks:"
                            echo -n "Landing Page: "
                            curl -s -o /dev/null -w "%{http_code}" https://complyo.tech
                            echo ""
                            
                            echo -n "Backend API: "
                            curl -s -o /dev/null -w "%{http_code}" https://api.complyo.tech/health
                            echo ""
                            
                            echo -n "Dashboard: "
                            curl -s -o /dev/null -w "%{http_code}" https://app.complyo.tech
                            echo ""
                            
                            echo ""
                            echo "Recent Logs:"
                            echo "Backend:"
                            docker logs complyo-backend-v2 --tail 5
                            echo ""
                            echo "Worker:"
                            docker logs complyo-worker --tail 5 2>/dev/null || echo "Worker not running"
                            EOF
                            
                            chmod +x monitor.sh
                            echo "✅ Monitoring-Script erstellt: ./monitor.sh"
                            
                            echo ""
                            echo "🎉 VOLLSTÄNDIGES DEPLOYMENT ERFOLGREICH!"
                            echo "========================================"
                            echo ""
                            echo "Ihre Complyo-Plattform ist jetzt live:"
                            echo "• Landing Page: https://complyo.tech"
                            echo "• API Backend:  https://api.complyo.tech"  
                            echo "• Dashboard:    https://app.complyo.tech"
                            echo ""
                            echo "Führen Sie './monitor.sh' aus für Status-Checks"
                            echo "Logs: docker logs [container-name]"
                            echo ""
                            echo "Viel Erfolg mit Complyo! 🚀"